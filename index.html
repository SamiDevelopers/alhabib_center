<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        :root {
            --primary-color: #8B4513;
            --primary-dark: #654321;
            --primary-light: #A0522D;
            --secondary-color: #DAA520;
            --accent-color: #CD853F;
            --success-color: #228B22;
            --danger-color: #DC143C;
            --warning-color: #FF8C00;
            --info-color: #4682B4;
            --light-bg: #FFF8DC;
            --card-bg: #FFFAF0;
        }
        
        body {
            background: linear-gradient(135deg, #FFF8DC 0%, #FAEBD7 100%);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 50%, var(--primary-light) 100%);
        }
        
        .admin-gradient {
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 50%, #FF6347 100%);
        }
        
        .teacher-gradient {
            background: linear-gradient(135deg, #006400 0%, #228B22 50%, #32CD32 100%);
        }
        
        .student-gradient {
            background: linear-gradient(135deg, #191970 0%, #4169E1 50%, #6495ED 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 40px rgba(139, 69, 19, 0.15);
            border: 2px solid rgba(218, 165, 32, 0.2);
        }
        
        .hover-lift {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(139, 69, 19, 0.25);
        }
        
        .fade-in {
            animation: fadeIn 1s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .nav-item {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            padding: 10px 20px;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--secondary-color);
            transition: all 0.3s ease;
        }
        
        .nav-item:hover::before,
        .nav-item.active::before {
            width: 100%;
        }
        
        .nav-item:hover {
            background: rgba(218, 165, 32, 0.1);
        }
        
        .nav-item.active {
            background: rgba(218, 165, 32, 0.2);
            font-weight: 700;
        }
        
        .loading-spinner {
            border: 3px solid rgba(218, 165, 32, 0.3);
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .danger-zone {
            border: 3px solid var(--danger-color);
            background: linear-gradient(135deg, #FFF0F0 0%, #FFE0E0 100%);
            border-radius: 12px;
        }
        
        .backup-card {
            border: 2px solid rgba(218, 165, 32, 0.3);
            transition: all 0.3s ease;
            background: var(--card-bg);
            border-radius: 12px;
        }
        
        .backup-card:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 8px 24px rgba(218, 165, 32, 0.3);
            transform: translateY(-4px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 69, 19, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #B8860B 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #006400 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #8B0000 100%);
            color: white;
        }
        
        .attendance-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--success-color);
        }
        
        .week-card {
            background: white;
            border: 2px solid rgba(218, 165, 32, 0.2);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        
        .week-card:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 4px 16px rgba(218, 165, 32, 0.2);
        }
        
        .grade-input {
            border: 2px solid rgba(218, 165, 32, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            transition: all 0.3s ease;
        }
        
        .grade-input:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(218, 165, 32, 0.1);
        }
        
        .coptic-icon {
            font-size: 2rem;
            color: var(--primary-color);
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .status-present {
            background: #E8F5E9;
            color: #2E7D32;
        }
        
        .status-absent {
            background: #FFEBEE;
            color: #C62828;
        }
        
        .status-excused {
            background: #FFF3E0;
            color: #E65100;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-gray-50"><!-- Header -->
  <header class="gradient-bg text-white shadow-lg">
   <div class="container mx-auto px-4 py-6">
    <div class="flex items-center justify-between">
     <div class="flex items-center space-x-4 space-x-reverse">
      <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
       <svg class="w-10 h-10 text-blue-600" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" /> <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2" />
       </svg>
      </div>
      <div>
       <h1 id="systemTitle" class="text-2xl font-bold">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h1>
       <p id="centerInfo" class="text-blue-200"><span id="centerName">Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</span> - <span id="churchName">ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ ÙˆØ§Ù„Ù‚Ø¯ÙŠØ³ Ù…Ø§Ø± ÙŠÙˆØ­Ù†Ø§</span></p>
      </div>
     </div>
     <div id="userInfo" class="hidden text-left">
      <div class="text-sm text-blue-200">
       Ù…Ø±Ø­Ø¨Ø§Ù‹
      </div>
      <div id="userName" class="font-semibold"></div>
      <div id="userRole" class="text-xs text-blue-300"></div>
     </div>
    </div>
   </div>
  </header><!-- Navigation -->
  <nav class="bg-white shadow-md sticky top-0 z-50">
   <div class="container mx-auto px-4">
    <div class="flex justify-center space-x-8 space-x-reverse py-4" id="mainNavigation"><button class="nav-item active px-4 py-2 text-gray-700 hover:text-blue-600 font-semibold transition-colors" onclick="showSection('home')"> ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© </button> <button class="nav-item px-4 py-2 text-gray-700 hover:text-blue-600 font-semibold transition-colors" onclick="showSection('login')"> ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ </button>
    </div><!-- Admin Navigation -->
    <div id="adminNavigation" class="hidden flex justify-center space-x-6 space-x-reverse py-4 border-t border-gray-200"><button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-red-600 font-semibold transition-colors" onclick="showAdminSection('dashboard')"> ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-red-600 font-semibold transition-colors" onclick="showAdminSection('students')"> ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-red-600 font-semibold transition-colors" onclick="showAdminSection('teachers')"> ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ø§Ù… </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-red-600 font-semibold transition-colors" onclick="showAdminSection('attendance')"> ğŸ“ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-red-600 font-semibold transition-colors" onclick="showAdminSection('grades')"> ğŸ“ˆ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-red-600 font-semibold transition-colors" onclick="showAdminSection('backup')"> ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ </button>
    </div><!-- Teacher Navigation -->
    <div id="teacherNavigation" class="hidden flex justify-center space-x-6 space-x-reverse py-4 border-t border-gray-200"><button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-green-600 font-semibold transition-colors" onclick="showTeacherSection('dashboard')"> ğŸ¯ Ù„ÙˆØ­Ø© Ø§Ù„Ø®Ø§Ø¯Ù… </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-green-600 font-semibold transition-colors" onclick="showTeacherSection('attendance')"> âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-green-600 font-semibold transition-colors" onclick="showTeacherSection('homework')"> ğŸ“š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-green-600 font-semibold transition-colors" onclick="showTeacherSection('grades')"> ğŸ“Š Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-green-600 font-semibold transition-colors" onclick="showTeacherSection('students')"> ğŸ‘¥ Ø·Ù„Ø§Ø¨ÙŠ </button>
    </div><!-- Student Navigation -->
    <div id="studentNavigation" class="hidden flex justify-center space-x-6 space-x-reverse py-4 border-t border-gray-200"><button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-purple-600 font-semibold transition-colors" onclick="showStudentSection('profile')"> ğŸ‘¤ Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-purple-600 font-semibold transition-colors" onclick="showStudentSection('grades')"> ğŸ“Š Ø¯Ø±Ø¬Ø§ØªÙŠ </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-purple-600 font-semibold transition-colors" onclick="showStudentSection('attendance')"> ğŸ“… Ø­Ø¶ÙˆØ±ÙŠ </button> <button class="nav-item px-3 py-2 text-sm text-gray-700 hover:text-purple-600 font-semibold transition-colors" onclick="showStudentSection('homework')"> ğŸ“š Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª </button>
    </div>
   </div>
  </nav><!-- Main Content -->
  <main class="container mx-auto px-4 py-8"><!-- Home Section -->
   <section id="home" class="section-content fade-in">
    <div class="text-center mb-12">
     <h2 class="text-4xl font-bold text-gray-800 mb-4">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h2>
     <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Serverless ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù… Backend - Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­</p>
    </div><!-- System Features -->
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-8 card-shadow mb-8">
     <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ¯ Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</h3>
     <div class="grid md:grid-cols-3 gap-6">
      <div class="text-center p-4 bg-white rounded-lg">
       <div class="text-3xl mb-3">
        ğŸ’¾
       </div>
       <h4 class="font-bold text-blue-800 mb-2">ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ</h4>
       <p class="text-sm text-blue-600">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ - Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø®Ø§Ø¯Ù…</p>
      </div>
      <div class="text-center p-4 bg-white rounded-lg">
       <div class="text-3xl mb-3">
        ğŸ“¥
       </div>
       <h4 class="font-bold text-green-800 mb-2">Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØªØµØ¯ÙŠØ±</h4>
       <p class="text-sm text-green-600">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙƒØ§Ù…Ù„ Ø¨ØµÙŠØºØ© Excel Ùˆ JSON</p>
      </div>
      <div class="text-center p-4 bg-white rounded-lg">
       <div class="text-3xl mb-3">
        ğŸ”’
       </div>
       <h4 class="font-bold text-purple-800 mb-2">Ø£Ù…Ø§Ù† ÙƒØ§Ù…Ù„</h4>
       <p class="text-sm text-purple-600">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø§ ØªØºØ§Ø¯Ø± Ø¬Ù‡Ø§Ø²Ùƒ Ø£Ø¨Ø¯Ø§Ù‹</p>
      </div>
     </div>
    </div><!-- User Types -->
    <div class="grid md:grid-cols-3 gap-8 mb-12"><!-- Admin Panel -->
     <div class="bg-white rounded-lg p-8 card-shadow hover-lift border-t-4 border-red-500">
      <div class="text-center">
       <div class="w-20 h-20 admin-gradient rounded-full flex items-center justify-center mx-auto mb-6"><span class="text-3xl text-white">ğŸ‘¨â€ğŸ’¼</span>
       </div>
       <h3 class="text-2xl font-bold text-gray-800 mb-4">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
       <div class="text-gray-600 space-y-2 mb-6">
        <p>â€¢ Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† ÙˆØ§Ù„Ø®Ø¯Ø§Ù…</p>
        <p>â€¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª</p>
        <p>â€¢ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙƒØ§Ù…Ù„</p>
        <p>â€¢ ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø©</p>
       </div>
       <div class="bg-red-50 border border-red-200 rounded-lg p-3">
        <p class="text-sm text-red-700 font-semibold">Username: ADMIN</p>
        <p class="text-sm text-red-700 font-semibold">Password: admin123</p>
       </div>
      </div>
     </div><!-- Teacher Panel -->
     <div class="bg-white rounded-lg p-8 card-shadow hover-lift border-t-4 border-green-500">
      <div class="text-center">
       <div class="w-20 h-20 teacher-gradient rounded-full flex items-center justify-center mx-auto mb-6"><span class="text-3xl text-white">ğŸ‘¨â€ğŸ«</span>
       </div>
       <h3 class="text-2xl font-bold text-gray-800 mb-4">Ù„ÙˆØ­Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h3>
       <div class="text-gray-600 space-y-2 mb-6">
        <p>â€¢ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</p>
        <p>â€¢ Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</p>
        <p>â€¢ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</p>
        <p>â€¢ Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¶ÙŠØ±</p>
       </div>
       <div class="bg-green-50 border border-green-200 rounded-lg p-3">
        <p class="text-sm text-green-700 font-semibold">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù… + ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
       </div>
      </div>
     </div><!-- Student Panel -->
     <div class="bg-white rounded-lg p-8 card-shadow hover-lift border-t-4 border-purple-500">
      <div class="text-center">
       <div class="w-20 h-20 student-gradient rounded-full flex items-center justify-center mx-auto mb-6"><span class="text-3xl text-white">ğŸ‘¨â€ğŸ“</span>
       </div>
       <h3 class="text-2xl font-bold text-gray-800 mb-4">Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø§Ø±Ø³</h3>
       <div class="text-gray-600 space-y-2 mb-6">
        <p>â€¢ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬</p>
        <p>â€¢ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</p>
        <p>â€¢ ØªØ³Ù„ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</p>
        <p>â€¢ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯</p>
       </div>
       <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
        <p class="text-sm text-purple-700 font-semibold">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³ Ø§Ù„ÙØ±ÙŠØ¯</p>
       </div>
      </div>
     </div>
    </div><!-- Storage Info -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
     <h3 class="text-xl font-bold text-blue-800 mb-4">ğŸ’¾ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ†</h3>
     <div class="grid md:grid-cols-2 gap-6">
      <div class="bg-white p-4 rounded-lg">
       <h4 class="font-bold text-blue-800 mb-3">ğŸ“¦ LocalStorage</h4>
       <div class="space-y-2 text-sm">
        <p>â€¢ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† ÙˆØ§Ù„Ø®Ø¯Ø§Ù…</p>
        <p>â€¢ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª</p>
        <p>â€¢ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</p>
        <p>â€¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</p>
       </div>
      </div>
      <div class="bg-white p-4 rounded-lg">
       <h4 class="font-bold text-green-800 mb-3">ğŸ“¥ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h4>
       <div class="space-y-2 text-sm">
        <p>â€¢ ØªØµØ¯ÙŠØ± Excel (Ø¯Ø§Ø±Ø³ÙŠÙ† / Ø®Ø¯Ø§Ù… / ÙƒØ§Ù…Ù„)</p>
        <p>â€¢ ØªØµØ¯ÙŠØ± JSON</p>
        <p>â€¢ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel</p>
        <p>â€¢ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† JSON</p>
       </div>
      </div>
     </div>
    </div>
   </section><!-- Login Section -->
   <section id="login" class="section-content hidden">
    <div class="max-w-md mx-auto bg-white rounded-lg p-8 card-shadow">
     <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
     <div class="mb-6">
      <div class="flex border-b border-gray-200"><button id="adminTab" class="flex-1 py-3 px-4 text-center font-semibold text-gray-500" onclick="switchLoginTab('admin')"> ğŸ‘¨â€ğŸ’¼ Ø¥Ø¯Ø§Ø±Ø© </button> <button id="teacherTab" class="flex-1 py-3 px-4 text-center font-semibold text-gray-500" onclick="switchLoginTab('teacher')"> ğŸ‘¨â€ğŸ« Ø®Ø§Ø¯Ù… </button> <button id="studentTab" class="flex-1 py-3 px-4 text-center font-semibold text-blue-600 border-b-2 border-blue-600" onclick="switchLoginTab('student')"> ğŸ‘¨â€ğŸ“ Ø¯Ø§Ø±Ø³ </button>
      </div>
     </div>
     <form id="loginForm" onsubmit="handleLogin(event)">
      <div id="studentLogin">
       <div class="mb-6"><label for="studentCode" class="block text-sm font-semibold text-gray-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³</label> <input type="text" id="studentCode" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ù…Ø«Ø§Ù„: DQ34ZA54">
       </div>
      </div>
      <div id="teacherLogin" class="hidden">
       <div class="mb-4"><label for="teacherCode" class="block text-sm font-semibold text-gray-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…</label> <input type="text" id="teacherCode" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Ù…Ø«Ø§Ù„: FZ64SZ56">
       </div>
       <div class="mb-6"><label for="teacherPassword" class="block text-sm font-semibold text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> <input type="password" id="teacherPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
       </div>
      </div>
      <div id="adminLogin" class="hidden">
       <div class="mb-4"><label for="adminUsername" class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label> <input type="text" id="adminUsername" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="ADMIN">
       </div>
       <div class="mb-6"><label for="adminPassword" class="block text-sm font-semibold text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> <input type="password" id="adminPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="admin123">
       </div>
      </div><button type="submit" id="loginButton" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors"> <span class="flex items-center justify-center gap-2"> <span id="loginButtonText">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³</span>
        <div id="loginSpinner" class="loading-spinner hidden"></div></span> </button>
     </form>
     <div class="mt-6 text-center"><button onclick="logout()" class="text-gray-500 hover:text-gray-700 text-sm"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ </button>
     </div>
    </div>
   </section><!-- Admin Dashboard -->
   <section id="adminDashboard" class="section-content hidden">
    <div class="bg-white rounded-lg p-8 card-shadow">
     <div class="flex justify-between items-center mb-8">
      <div>
       <h2 class="text-3xl font-bold text-gray-800">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
       <p class="text-gray-600">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨</p>
      </div><button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ </button>
     </div><!-- Quick Stats -->
     <div class="grid md:grid-cols-4 gap-6 mb-8">
      <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 text-center">
       <div class="text-3xl mb-2">
        ğŸ‘¥
       </div>
       <h3 class="text-2xl font-bold text-blue-800" id="totalStudentsCount">0</h3>
       <p class="text-blue-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</p>
      </div>
      <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 text-center">
       <div class="text-3xl mb-2">
        ğŸ‘¨â€ğŸ«
       </div>
       <h3 class="text-2xl font-bold text-green-800" id="totalTeachersCount">0</h3>
       <p class="text-green-600">Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø¯Ø§Ù…</p>
      </div>
      <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-6 text-center">
       <div class="text-3xl mb-2">
        ğŸ“Š
       </div>
       <h3 class="text-2xl font-bold text-yellow-800" id="attendanceRate">0%</h3>
       <p class="text-yellow-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</p>
      </div>
      <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 text-center">
       <div class="text-3xl mb-2">
        ğŸ“ˆ
       </div>
       <h3 class="text-2xl font-bold text-purple-800" id="avgGrade">0%</h3>
       <p class="text-purple-600">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</p>
      </div>
     </div>
     <div id="adminContent">
      <div class="text-center py-12">
       <div class="text-6xl mb-4">
        ğŸ“Š
       </div>
       <p class="text-gray-500 text-lg">Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ</p>
      </div>
     </div>
    </div>
   </section><!-- Teacher Dashboard -->
   <section id="teacherDashboard" class="section-content hidden">
    <div class="bg-white rounded-lg p-8 card-shadow">
     <div class="flex justify-between items-center mb-8">
      <div>
       <h2 class="text-3xl font-bold text-gray-800">Ù„ÙˆØ­Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h2>
       <p class="text-gray-600" id="teacherWelcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</p>
      </div><button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ </button>
     </div>
     <div id="teacherContent">
      <div class="text-center py-12">
       <div class="text-6xl mb-4">
        ğŸ¯
       </div>
       <p class="text-gray-500 text-lg">Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ</p>
      </div>
     </div>
    </div>
   </section><!-- Student Dashboard -->
   <section id="studentDashboard" class="section-content hidden">
    <div class="bg-white rounded-lg p-8 card-shadow">
     <div class="flex justify-between items-center mb-8">
      <div>
       <h2 class="text-3xl font-bold text-gray-800">Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</h2>
       <p class="text-gray-600" id="studentWelcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</p>
      </div><button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ </button>
     </div>
     <div id="studentContent">
      <div class="text-center py-12">
       <div class="text-6xl mb-4">
        ğŸ‘¨â€ğŸ“
       </div>
       <p class="text-gray-500 text-lg">Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ</p>
      </div>
     </div>
    </div>
   </section>
  </main><!-- Footer -->
  <footer class="gradient-bg text-white mt-16">
   <div class="container mx-auto px-4 py-8">
    <div class="text-center">
     <h3 class="text-xl font-bold mb-4">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h3>
     <p class="text-blue-200 mb-4">Ù†Ø¸Ø§Ù… Serverless Ù…ØªÙƒØ§Ù…Ù„ - Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
     <p class="text-sm text-blue-100">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2024</p>
    </div>
   </div>
  </footer>
  <script>
        // Configuration
        const defaultConfig = {
            system_title: "Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
            center_name: "Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©",
            church_name: "ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ ÙˆØ§Ù„Ù‚Ø¯ÙŠØ³ Ù…Ø§Ø± ÙŠÙˆØ­Ù†Ø§"
        };

        // Current user and state
        let currentUser = null;
        let currentLoginTab = 'student';

        // Storage Keys
        const STORAGE_KEYS = {
            STUDENTS: 'alhabeeb_students',
            TEACHERS: 'alhabeeb_teachers',
            ATTENDANCE: 'alhabeeb_attendance',
            GRADES: 'alhabeeb_grades',
            HOMEWORK: 'alhabeeb_homework',
            ADMIN: 'alhabeeb_admin'
        };

        // Default Admin Account
        const DEFAULT_ADMIN = {
            username: 'ADMIN',
            password: 'admin123',
            name: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…'
        };

        // Educational Stages
        const STAGES = [
            'KG1',
            'KG2',
            'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ',
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ',
            'Ø´Ø¨Ø§Ø¨',
            'Ø®Ø±ÙŠØ¬ÙŠÙ†',
            'Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø£Ù…ÙˆØ±'
        ];

        // Classes
        const CLASSES = [
            'ØªÙ…Ù‡ÙŠØ¯ÙŠ',
            'Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©',
            'Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©',
            'Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©',
            'Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ',
            'Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†'
        ];

        // Teacher Specialties
        const SPECIALTIES = [
            'Ø£Ø¯Ø§Ø±ÙŠ',
            'Ø¯Ø±Ø§Ø³ÙŠ - Ø·Ù‚ÙˆØ³',
            'Ø¯Ø±Ø§Ø³ÙŠ - Ù„ØºØ© Ù‚Ø¨Ø·ÙŠØ©',
            'Ø¯Ø±Ø§Ø³ÙŠ - Ø§Ù„Ø­Ø§Ù†',
            'Ø¯Ø±Ø§Ø³ÙŠ Ù…Ø­ÙÙˆØ¸Ø§Øª',
            'Ù…Ø³Ø¤ÙˆÙ„',
            'Ø¯Ø±Ø§Ø³ÙŠ - Ø·Ù‚ÙˆØ³ ÙˆÙ…Ø­ÙÙˆØ¸Ø§Øª',
            'Ø£Ø¯Ø§Ø±ÙŠ - Ø¯Ø±Ø§Ø³ÙŠ'
        ];
        
        // Student Types
        const STUDENT_TYPES = [
            'Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯',
            'Ø¯Ø§Ø±Ø³ Ù‚Ø¯ÙŠÙ…'
        ];

        // Generate Random Code
        function generateCode(prefix = '') {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = prefix;
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // LocalStorage Helper Functions
        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                return false;
            }
        }

        function loadFromStorage(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                return defaultValue;
            }
        }

        // Initialize System
        async function initializeSystem() {
            try {
                // Initialize Element SDK
                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (config) => {
                            document.getElementById('systemTitle').textContent = config.system_title || defaultConfig.system_title;
                            document.getElementById('centerName').textContent = config.center_name || defaultConfig.center_name;
                            document.getElementById('churchName').textContent = config.church_name || defaultConfig.church_name;
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ["system_title", config.system_title || defaultConfig.system_title],
                            ["center_name", config.center_name || defaultConfig.center_name],
                            ["church_name", config.church_name || defaultConfig.church_name]
                        ])
                    });
                }

                // Initialize Data SDK
                if (window.dataSdk) {
                    const dataHandler = {
                        onDataChanged(data) {
                            console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', data.length);
                        }
                    };
                    
                    const result = await window.dataSdk.init(dataHandler);
                    if (result.isOk) {
                        console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Data SDK Ø¨Ù†Ø¬Ø§Ø­');
                    }
                }

                // Initialize default admin if not exists
                const admin = loadFromStorage(STORAGE_KEYS.ADMIN, null);
                if (!admin) {
                    saveToStorage(STORAGE_KEYS.ADMIN, DEFAULT_ADMIN);
                }

                // Load initial data
                updateDashboardStats();
                
                console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
            }
        }

        // Navigation functions
        function showSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            document.querySelectorAll('#mainNavigation .nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Login functions
        function switchLoginTab(tab) {
            currentLoginTab = tab;
            
            document.querySelectorAll('[id$="Tab"]').forEach(tabBtn => {
                tabBtn.className = 'flex-1 py-3 px-4 text-center font-semibold text-gray-500';
            });
            
            const colors = {
                admin: 'text-red-600 border-b-2 border-red-600',
                teacher: 'text-green-600 border-b-2 border-green-600',
                student: 'text-blue-600 border-b-2 border-blue-600'
            };
            
            document.getElementById(tab + 'Tab').className += ' ' + colors[tab];
            
            document.getElementById('adminLogin').classList.toggle('hidden', tab !== 'admin');
            document.getElementById('teacherLogin').classList.toggle('hidden', tab !== 'teacher');
            document.getElementById('studentLogin').classList.toggle('hidden', tab !== 'student');
            
            const buttonColors = {
                admin: 'bg-red-600 hover:bg-red-700',
                teacher: 'bg-green-600 hover:bg-green-700',
                student: 'bg-blue-600 hover:bg-blue-700'
            };
            
            const buttonTexts = {
                admin: 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
                teacher: 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…',
                student: 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³'
            };
            
            const loginButton = document.getElementById('loginButton');
            loginButton.className = `w-full ${buttonColors[tab]} text-white py-3 px-4 rounded-lg font-semibold transition-colors`;
            document.getElementById('loginButtonText').textContent = buttonTexts[tab];
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const spinner = document.getElementById('loginSpinner');
            const buttonText = document.getElementById('loginButtonText');
            
            spinner.classList.remove('hidden');
            buttonText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            
            try {
                let loginSuccess = false;
                let userData = null;
                
                if (currentLoginTab === 'student') {
                    const code = document.getElementById('studentCode').value.trim().toUpperCase();
                    
                    if (!code) {
                        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³', 'error');
                        return;
                    }
                    
                    const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
                    userData = students.find(s => s.code === code);
                    
                    if (userData) {
                        currentUser = { type: 'student', data: userData };
                        loginSuccess = true;
                        showStudentDashboard();
                    }
                } else if (currentLoginTab === 'teacher') {
                    const code = document.getElementById('teacherCode').value.trim().toUpperCase();
                    const password = document.getElementById('teacherPassword').value.trim();
                    
                    if (!code || !password) {
                        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                        return;
                    }
                    
                    const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
                    userData = teachers.find(t => t.code === code && t.password === password);
                    
                    if (userData) {
                        currentUser = { type: 'teacher', data: userData };
                        loginSuccess = true;
                        showTeacherDashboard();
                    }
                } else if (currentLoginTab === 'admin') {
                    const username = document.getElementById('adminUsername').value.trim();
                    const password = document.getElementById('adminPassword').value.trim();
                    
                    if (!username || !password) {
                        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                        return;
                    }
                    
                    const admin = loadFromStorage(STORAGE_KEYS.ADMIN, DEFAULT_ADMIN);
                    
                    if (username === admin.username && password === admin.password) {
                        currentUser = { type: 'admin', data: admin };
                        loginSuccess = true;
                        showAdminDashboard();
                    }
                }
                
                if (loginSuccess) {
                    showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ${userData ? userData.name : currentUser.data.name}`, 'success');
                    document.getElementById('loginForm').reset();
                    updateUserInfo();
                } else {
                    showToast('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            } finally {
                spinner.classList.add('hidden');
                const buttonTexts = {
                    admin: 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
                    teacher: 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…',
                    student: 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³'
                };
                buttonText.textContent = buttonTexts[currentLoginTab];
            }
        }

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const userRole = document.getElementById('userRole');
            
            if (currentUser) {
                userInfo.classList.remove('hidden');
                userName.textContent = currentUser.data.name;
                
                const roleTexts = {
                    admin: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    teacher: 'Ø®Ø§Ø¯Ù… - ' + (currentUser.data.specialty || ''),
                    student: 'Ø¯Ø§Ø±Ø³ - ' + (currentUser.data.stage || '')
                };
                
                userRole.textContent = roleTexts[currentUser.type];
            } else {
                userInfo.classList.add('hidden');
            }
        }

        function showAdminDashboard() {
            showSection('adminDashboard');
            document.getElementById('adminNavigation').classList.remove('hidden');
            document.getElementById('teacherNavigation').classList.add('hidden');
            document.getElementById('studentNavigation').classList.add('hidden');
            updateDashboardStats();
        }

        function showTeacherDashboard() {
            showSection('teacherDashboard');
            document.getElementById('adminNavigation').classList.add('hidden');
            document.getElementById('teacherNavigation').classList.remove('hidden');
            document.getElementById('studentNavigation').classList.add('hidden');
            
            const welcome = document.getElementById('teacherWelcome');
            welcome.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.data.name} - ${currentUser.data.specialty}`;
        }

        function showStudentDashboard() {
            showSection('studentDashboard');
            document.getElementById('adminNavigation').classList.add('hidden');
            document.getElementById('teacherNavigation').classList.add('hidden');
            document.getElementById('studentNavigation').classList.remove('hidden');
            
            const welcome = document.getElementById('studentWelcome');
            welcome.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.data.name} - ${currentUser.data.stage}`;
        }

        function logout() {
            currentUser = null;
            document.getElementById('adminNavigation').classList.add('hidden');
            document.getElementById('teacherNavigation').classList.add('hidden');
            document.getElementById('studentNavigation').classList.add('hidden');
            updateUserInfo();
            showSection('home');
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Admin Sections
        function showAdminSection(section) {
            const content = document.getElementById('adminContent');
            
            if (section === 'dashboard') {
                const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
                const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
                
                content.innerHTML = `
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-blue-50 rounded-lg p-6">
                            <h3 class="text-xl font-bold text-blue-800 mb-4">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†:</span>
                                    <span class="font-bold">${students.length}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø¯Ø§Ù…:</span>
                                    <span class="font-bold">${teachers.length}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø¹Ø§Ù…:</span>
                                    <span class="font-bold text-green-600">85%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 rounded-lg p-6">
                            <h3 class="text-xl font-bold text-green-800 mb-4">ğŸ¯ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                            <div class="space-y-2">
                                <button onclick="showAdminSection('students')" class="w-full text-right p-3 bg-white rounded hover:bg-gray-50 transition-colors">
                                    ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†
                                </button>
                                <button onclick="showAdminSection('teachers')" class="w-full text-right p-3 bg-white rounded hover:bg-gray-50 transition-colors">
                                    ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ø§Ù…
                                </button>
                                <button onclick="showAdminSection('backup')" class="w-full text-right p-3 bg-white rounded hover:bg-gray-50 transition-colors">
                                    ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (section === 'students') {
                showStudentsManagement();
            } else if (section === 'teachers') {
                showTeachersManagement();
            } else if (section === 'attendance') {
                showAttendanceManagement();
            } else if (section === 'grades') {
                showGradesManagement();
            } else if (section === 'backup') {
                showBackupPage();
            }
        }

        // Students Management
        function showStudentsManagement() {
            const content = document.getElementById('adminContent');
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            
            content.innerHTML = `
                <div class="mb-6 flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h3>
                    <button onclick="showAddStudentForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                
                <div class="bg-white rounded-lg p-4">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-center">Ù…</th>
                                    <th class="p-3 text-center">Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                    <th class="p-3 text-center">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                    <th class="p-3 text-right">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                    <th class="p-3 text-center">Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th class="p-3 text-center">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                    <th class="p-3 text-center">Ø§Ù„ÙØµÙ„</th>
                                    <th class="p-3 text-center">Ø§Ù„Ù‡Ø§ØªÙ</th>
                                    <th class="p-3 text-center">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${students.length === 0 ? `
                                    <tr>
                                        <td colspan="9" class="p-8 text-center text-gray-500">
                                            Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯
                                        </td>
                                    </tr>
                                ` : students.map((student, index) => `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3 text-center text-gray-600">${index + 1}</td>
                                        <td class="p-3 text-center">
                                            <span class="px-2 py-1 rounded text-xs ${student.studentType === 'Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                                ${student.studentType || 'Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯'}
                                            </span>
                                        </td>
                                        <td class="p-3 text-center font-mono text-xs bg-gray-50">${student.code}</td>
                                        <td class="p-3 font-semibold">${student.name}</td>
                                        <td class="p-3 text-center">${student.gender}</td>
                                        <td class="p-3 text-center text-xs">${student.stage}</td>
                                        <td class="p-3 text-center text-xs">${student.className}</td>
                                        <td class="p-3 text-center text-xs">${student.phone1}</td>
                                        <td class="p-3 text-center">
                                            <button onclick="viewStudent('${student.code}')" class="text-green-600 hover:text-green-800 mx-1" title="Ø¹Ø±Ø¶">ğŸ‘ï¸</button>
                                            <button onclick="editStudent('${student.code}')" class="text-blue-600 hover:text-blue-800 mx-1" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                                            <button onclick="deleteStudent('${student.code}')" class="text-red-600 hover:text-red-800 mx-1" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function showAddStudentForm() {
            const modal = createModal('Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯', `
                <form id="addStudentForm" onsubmit="saveStudent(event)" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³ *</label>
                            <select name="studentType" required class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="">Ø§Ø®ØªØ±...</option>
                                ${STUDENT_TYPES.map(type => `<option value="${type}">${type}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³</label>
                            <input type="text" name="code" id="studentCodeInput" readonly class="w-full p-2 border border-gray-300 rounded-lg bg-gray-100 font-mono" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                            <input type="text" name="name" required class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Ù…Ø«Ø§Ù„: ÙƒØ§Ø±Ù† Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„ ÙØ¤Ø§Ø¯">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ù†ÙˆØ¹ *</label>
                            <select name="gender" required class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="">Ø§Ø®ØªØ±...</option>
                                <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                                <option value="Ø£Ù†Ø«ÙŠ">Ø£Ù†Ø«ÙŠ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                            <input type="date" name="birthDate" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© *</label>
                            <select name="stage" required class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="">Ø§Ø®ØªØ±...</option>
                                ${STAGES.map(stage => `<option value="${stage}">${stage}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1 *</label>
                            <input type="tel" name="phone1" required class="w-full p-2 border border-gray-300 rounded-lg" placeholder="01XXXXXXXXX">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2</label>
                            <input type="tel" name="phone2" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="01XXXXXXXXX">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø­Ø±Ù Ø§Ù„ÙØµÙ„</label>
                            <select name="classLetter" class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="">Ø§Ø®ØªØ±...</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ² *</label>
                            <select name="className" required class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="">Ø§Ø®ØªØ±...</option>
                                ${CLASSES.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©</label>
                            <input type="text" name="rank" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="------------------">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <input type="text" name="address" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-4 pt-4 border-t">
                        <div class="flex items-center">
                            <input type="checkbox" name="hasForm" id="hasForm" class="ml-2 w-4 h-4">
                            <label for="hasForm" class="text-sm font-semibold">Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" name="hasPhoto" id="hasPhoto" class="ml-2 w-4 h-4">
                            <label for="hasPhoto" class="text-sm font-semibold">Ø§Ù„ØµÙˆØ±Ø©</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" name="formPaid" id="formPaid" class="ml-2 w-4 h-4">
                            <label for="formPaid" class="text-sm font-semibold">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</label>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯Ø§Ø±Ø³
                        </button>
                    </div>
                </form>
            `);
            
            // Generate code automatically
            document.getElementById('studentCodeInput').value = generateCode('');
        }

        function saveStudent(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            
            const newStudent = {
                studentType: formData.get('studentType'),
                code: formData.get('code') || generateCode(''),
                name: formData.get('name'),
                gender: formData.get('gender'),
                birthDate: formData.get('birthDate'),
                stage: formData.get('stage'),
                phone1: formData.get('phone1'),
                phone2: formData.get('phone2') || '',
                classLetter: formData.get('classLetter') || '',
                className: formData.get('className'),
                rank: formData.get('rank') || '------------------',
                address: formData.get('address') || '',
                hasForm: formData.get('hasForm') === 'on',
                hasPhoto: formData.get('hasPhoto') === 'on',
                formPaid: formData.get('formPaid') === 'on',
                createdAt: new Date().toISOString()
            };
            
            students.push(newStudent);
            
            if (saveToStorage(STORAGE_KEYS.STUDENTS, students)) {
                showToast(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„ÙƒÙˆØ¯: ${newStudent.code}`, 'success');
                closeModal();
                showStudentsManagement();
                updateDashboardStats();
            }
        }

        function deleteStudent(code) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø§Ø±Ø³ØŸ')) return;
            
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const filtered = students.filter(s => s.code !== code);
            
            if (saveToStorage(STORAGE_KEYS.STUDENTS, filtered)) {
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                showStudentsManagement();
                updateDashboardStats();
            }
        }

        // Teachers Management
        function showTeachersManagement() {
            const content = document.getElementById('adminContent');
            const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
            
            content.innerHTML = `
                <div class="mb-6 flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ø§Ù…</h3>
                    <button onclick="showAddTeacherForm()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        â• Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                
                <div class="bg-white rounded-lg p-4">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-center">Ù…</th>
                                    <th class="p-3 text-center">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…</th>
                                    <th class="p-3 text-right">Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…</th>
                                    <th class="p-3 text-center">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                                    <th class="p-3 text-center">Ø§Ù„ØªØ®ØµØµ</th>
                                    <th class="p-3 text-center">Ø£Ø¯Ø§Ø±ÙŠ</th>
                                    <th class="p-3 text-center">Ø§Ù„ÙØµÙ„</th>
                                    <th class="p-3 text-center">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${teachers.length === 0 ? `
                                    <tr>
                                        <td colspan="8" class="p-8 text-center text-gray-500">
                                            Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø¯Ø§Ù… Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯
                                        </td>
                                    </tr>
                                ` : teachers.map((teacher, index) => `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3 text-center text-gray-600">${index + 1}</td>
                                        <td class="p-3 text-center font-mono text-xs bg-gray-50">${teacher.code}</td>
                                        <td class="p-3 font-semibold">${teacher.name}</td>
                                        <td class="p-3 text-center text-xs">${teacher.phone}</td>
                                        <td class="p-3 text-center text-xs">${teacher.specialty}</td>
                                        <td class="p-3 text-center">
                                            ${teacher.isAdmin ? '<span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs">âœ“</span>' : '<span class="text-gray-400">-</span>'}
                                        </td>
                                        <td class="p-3 text-center text-xs">${teacher.className || '-'}</td>
                                        <td class="p-3 text-center">
                                            <button onclick="viewTeacher('${teacher.code}')" class="text-green-600 hover:text-green-800 mx-1" title="Ø¹Ø±Ø¶">ğŸ‘ï¸</button>
                                            <button onclick="editTeacher('${teacher.code}')" class="text-blue-600 hover:text-blue-800 mx-1" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                                            <button onclick="deleteTeacher('${teacher.code}')" class="text-red-600 hover:text-red-800 mx-1" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function showAddTeacherForm() {
            const modal = createModal('Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø¯Ù… Ø¬Ø¯ÙŠØ¯', `
                <form id="addTeacherForm" onsubmit="saveTeacher(event)" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…</label>
                            <input type="text" name="code" id="teacherCodeInput" readonly class="w-full p-2 border border-gray-300 rounded-lg bg-gray-100 font-mono" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù… *</label>
                            <input type="text" name="name" required class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Ù…Ø«Ø§Ù„: ÙƒØ±ÙŠØ³ØªÙŠÙ† ÙƒÙ…Ø§Ù„">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                            <input type="tel" name="phone" required class="w-full p-2 border border-gray-300 rounded-lg" placeholder="01XXXXXXXXX">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„ØªØ®ØµØµ *</label>
                            <select name="specialty" required class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="">Ø§Ø®ØªØ±...</option>
                                ${SPECIALTIES.map(spec => `<option value="${spec}">${spec}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„ÙØµÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù†Ù‡</label>
                            <select name="className" class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="">Ø§Ø®ØªØ±...</option>
                                ${CLASSES.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                            <input type="password" name="password" required class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" name="isAdmin" id="isAdmin" class="ml-2 w-4 h-4">
                            <label for="isAdmin" class="text-sm font-semibold">Ø£Ø¯Ø§Ø±ÙŠ</label>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø®Ø§Ø¯Ù…
                        </button>
                    </div>
                </form>
            `);
            
            // Generate code automatically
            document.getElementById('teacherCodeInput').value = generateCode('');
        }

        function saveTeacher(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
            
            const newTeacher = {
                code: formData.get('code') || generateCode(''),
                name: formData.get('name'),
                phone: formData.get('phone'),
                specialty: formData.get('specialty'),
                isAdmin: formData.get('isAdmin') === 'on',
                password: formData.get('password'),
                className: formData.get('className') || '',
                createdAt: new Date().toISOString()
            };
            
            teachers.push(newTeacher);
            
            if (saveToStorage(STORAGE_KEYS.TEACHERS, teachers)) {
                showToast(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„ÙƒÙˆØ¯: ${newTeacher.code}`, 'success');
                closeModal();
                showTeachersManagement();
                updateDashboardStats();
            }
        }

        function deleteTeacher(code) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø®Ø§Ø¯Ù…ØŸ')) return;
            
            const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
            const filtered = teachers.filter(t => t.code !== code);
            
            if (saveToStorage(STORAGE_KEYS.TEACHERS, filtered)) {
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                showTeachersManagement();
                updateDashboardStats();
            }
        }
        
        // View Student Details
        function viewStudent(code) {
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const student = students.find(s => s.code === code);
            
            if (!student) {
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø§Ø±Ø³', 'error');
                return;
            }
            
            const modal = createModal('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³', `
                <div class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³</div>
                            <div class="font-semibold">${student.studentType || 'Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯'}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³</div>
                            <div class="font-mono font-semibold">${student.code}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded md:col-span-2">
                            <div class="text-xs text-gray-600 mb-1">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</div>
                            <div class="font-semibold text-lg">${student.name}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø§Ù„Ù†ÙˆØ¹</div>
                            <div class="font-semibold">${student.gender}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</div>
                            <div class="font-semibold">${student.birthDate || '-'}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</div>
                            <div class="font-semibold">${student.stage}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²</div>
                            <div class="font-semibold">${student.className}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø­Ø±Ù Ø§Ù„ÙØµÙ„</div>
                            <div class="font-semibold">${student.classLetter || '-'}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©</div>
                            <div class="font-semibold">${student.rank || '-'}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1</div>
                            <div class="font-semibold">${student.phone1}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2</div>
                            <div class="font-semibold">${student.phone2 || '-'}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded md:col-span-2">
                            <div class="text-xs text-gray-600 mb-1">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</div>
                            <div class="font-semibold">${student.address || '-'}</div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="text-sm font-semibold text-gray-700 mb-3">Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</div>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="text-center p-3 rounded ${student.hasForm ? 'bg-green-50 text-green-800' : 'bg-gray-50 text-gray-400'}">
                                <div class="text-2xl mb-1">${student.hasForm ? 'âœ“' : 'âœ—'}</div>
                                <div class="text-xs">Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</div>
                            </div>
                            <div class="text-center p-3 rounded ${student.hasPhoto ? 'bg-green-50 text-green-800' : 'bg-gray-50 text-gray-400'}">
                                <div class="text-2xl mb-1">${student.hasPhoto ? 'âœ“' : 'âœ—'}</div>
                                <div class="text-xs">Ø§Ù„ØµÙˆØ±Ø©</div>
                            </div>
                            <div class="text-center p-3 rounded ${student.formPaid ? 'bg-green-50 text-green-800' : 'bg-gray-50 text-gray-400'}">
                                <div class="text-2xl mb-1">${student.formPaid ? 'âœ“' : 'âœ—'}</div>
                                <div class="text-xs">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button onclick="closeModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                            Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `);
        }
        
        // View Teacher Details
        function viewTeacher(code) {
            const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
            const teacher = teachers.find(t => t.code === code);
            
            if (!teacher) {
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
                return;
            }
            
            const modal = createModal('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…', `
                <div class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…</div>
                            <div class="font-mono font-semibold">${teacher.code}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…</div>
                            <div class="font-semibold text-lg">${teacher.name}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
                            <div class="font-semibold">${teacher.phone}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø§Ù„ØªØ®ØµØµ</div>
                            <div class="font-semibold">${teacher.specialty}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø§Ù„ÙØµÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù†Ù‡</div>
                            <div class="font-semibold">${teacher.className || '-'}</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="text-xs text-gray-600 mb-1">Ø£Ø¯Ø§Ø±ÙŠ</div>
                            <div class="font-semibold">${teacher.isAdmin ? 'Ù†Ø¹Ù… âœ“' : 'Ù„Ø§'}</div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button onclick="closeModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                            Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `);
        }

        // Attendance Management
        function showAttendanceManagement() {
            const content = document.getElementById('adminContent');
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            
            // Generate weeks for Term 1 (15 weeks from Sep 5 to Dec 12)
            const weeks = generateTermWeeks();
            const currentWeek = getCurrentWeek(weeks);
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ - Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„</h3>
                            <p class="text-gray-600">15 Ø£Ø³Ø¨ÙˆØ¹ (5 Ø³Ø¨ØªÙ…Ø¨Ø± - 12 Ø¯ÙŠØ³Ù…Ø¨Ø± 2024)</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-600">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                            <div class="text-xl font-bold" style="color: var(--primary-color)">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${currentWeek}</div>
                        </div>
                    </div>
                    
                    <!-- Week Selector -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <label class="block text-sm font-bold text-gray-700 mb-3">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                        <select id="weekSelector" onchange="loadWeekAttendance()" class="w-full p-3 border-2 rounded-lg" style="border-color: var(--secondary-color)">
                            ${weeks.map((week, index) => `
                                <option value="${index + 1}" ${index + 1 === currentWeek ? 'selected' : ''}>
                                    Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${index + 1} (${week.start} - ${week.end})
                                </option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <!-- Class Filter -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <label class="block text-sm font-bold text-gray-700 mb-3">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„</label>
                        <select id="classFilter" onchange="loadWeekAttendance()" class="w-full p-3 border-2 rounded-lg" style="border-color: var(--secondary-color)">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„</option>
                            ${CLASSES.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                        </select>
                    </div>
                    
                    <!-- Attendance Table -->
                    <div id="attendanceTableContainer" class="bg-white rounded-lg p-6 card-shadow">
                        <div class="text-center py-8 text-gray-500">
                            Ø§Ø®ØªØ± Ø£Ø³Ø¨ÙˆØ¹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¶ÙˆØ±
                        </div>
                    </div>
                    
                    <!-- Save Button -->
                    <div class="flex justify-end gap-3">
                        <button onclick="saveAttendance()" class="btn-success px-6 py-3 rounded-lg font-bold">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±
                        </button>
                        <button onclick="exportAttendanceReport()" class="btn-secondary px-6 py-3 rounded-lg font-bold">
                            ğŸ“Š ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ±
                        </button>
                    </div>
                </div>
            `;
            
            // Load current week attendance
            loadWeekAttendance();
        }
        
        // Generate 15 weeks for Term 1
        function generateTermWeeks() {
            const weeks = [];
            const startDate = new Date('2024-09-05'); // First Friday
            
            for (let i = 0; i < 15; i++) {
                const weekStart = new Date(startDate);
                weekStart.setDate(startDate.getDate() + (i * 7));
                
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 4); // Friday to Tuesday (5 days)
                
                weeks.push({
                    number: i + 1,
                    start: formatDate(weekStart),
                    end: formatDate(weekEnd),
                    startDate: weekStart,
                    endDate: weekEnd
                });
            }
            
            return weeks;
        }
        
        // Get current week number
        function getCurrentWeek(weeks) {
            const today = new Date();
            
            for (let i = 0; i < weeks.length; i++) {
                if (today >= weeks[i].startDate && today <= weeks[i].endDate) {
                    return i + 1;
                }
            }
            
            // If after all weeks, return last week
            if (today > weeks[weeks.length - 1].endDate) {
                return weeks.length;
            }
            
            // If before all weeks, return first week
            return 1;
        }
        
        // Format date as DD/MM
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            return `${day}/${month}`;
        }
        
        // Load attendance for selected week
        function loadWeekAttendance() {
            const weekNumber = parseInt(document.getElementById('weekSelector').value);
            const classFilter = document.getElementById('classFilter').value;
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            const weeks = generateTermWeeks();
            const selectedWeek = weeks[weekNumber - 1];
            
            // Filter students by class if selected
            let filteredStudents = students;
            if (classFilter) {
                filteredStudents = students.filter(s => s.className === classFilter);
            }
            
            // Sort by class and name
            filteredStudents.sort((a, b) => {
                if (a.className !== b.className) {
                    return a.className.localeCompare(b.className);
                }
                return a.name.localeCompare(b.name);
            });
            
            // Check if editing is allowed
            const today = new Date();
            const isEditingAllowed = currentUser && (
                currentUser.type === 'admin' || 
                (currentUser.type === 'teacher' && today <= selectedWeek.endDate)
            );
            
            const container = document.getElementById('attendanceTableContainer');
            
            if (filteredStudents.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙØµÙ„
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="mb-4 flex justify-between items-center">
                    <h4 class="text-xl font-bold" style="color: var(--primary-color)">
                        Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${weekNumber} (${selectedWeek.start} - ${selectedWeek.end})
                    </h4>
                    ${!isEditingAllowed ? `
                        <div class="text-sm px-4 py-2 rounded-lg" style="background: #FFF3E0; color: #E65100;">
                            âš ï¸ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ - ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                        </div>
                    ` : ''}
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead style="background: var(--light-bg);">
                            <tr>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ù…</th>
                                <th class="p-3 text-right" style="border: 2px solid var(--secondary-color);">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ø§Ù„ÙØµÙ„</th>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredStudents.map((student, index) => {
                                const attendanceRecord = attendance.find(a => 
                                    a.studentCode === student.code && a.week === weekNumber
                                );
                                const isPresent = attendanceRecord ? attendanceRecord.present : false;
                                
                                return `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3 text-center" style="border: 1px solid #ddd;">${index + 1}</td>
                                        <td class="p-3 font-semibold" style="border: 1px solid #ddd;">${student.name}</td>
                                        <td class="p-3 text-center text-xs" style="border: 1px solid #ddd;">${student.className}</td>
                                        <td class="p-3 text-center text-xs" style="border: 1px solid #ddd;">${student.stage}</td>
                                        <td class="p-3 text-center" style="border: 1px solid #ddd;">
                                            <input 
                                                type="checkbox" 
                                                class="attendance-checkbox" 
                                                data-student-code="${student.code}"
                                                data-week="${weekNumber}"
                                                ${isPresent ? 'checked' : ''}
                                                ${!isEditingAllowed ? 'disabled' : ''}
                                                onchange="updateAttendanceStatus(this)"
                                            >
                                        </td>
                                        <td class="p-3 text-center" style="border: 1px solid #ddd;">
                                            <span class="status-badge ${isPresent ? 'status-present' : 'status-absent'}">
                                                ${isPresent ? 'âœ“ Ø­Ø§Ø¶Ø±' : 'âœ— ØºØ§Ø¦Ø¨'}
                                            </span>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6 grid md:grid-cols-3 gap-4">
                    <div class="bg-green-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-800" id="presentCount">0</div>
                        <div class="text-sm text-green-600">Ø­Ø§Ø¶Ø±</div>
                    </div>
                    <div class="bg-red-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-red-800" id="absentCount">0</div>
                        <div class="text-sm text-red-600">ØºØ§Ø¦Ø¨</div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-800" id="attendanceRate">0%</div>
                        <div class="text-sm text-blue-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                    </div>
                </div>
            `;
            
            updateAttendanceStats();
        }
        
        // Update attendance status when checkbox changes
        function updateAttendanceStatus(checkbox) {
            updateAttendanceStats();
        }
        
        // Update attendance statistics
        function updateAttendanceStats() {
            const checkboxes = document.querySelectorAll('.attendance-checkbox');
            let presentCount = 0;
            let totalCount = checkboxes.length;
            
            checkboxes.forEach(cb => {
                if (cb.checked) presentCount++;
            });
            
            const absentCount = totalCount - presentCount;
            const rate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
            
            const presentEl = document.getElementById('presentCount');
            const absentEl = document.getElementById('absentCount');
            const rateEl = document.getElementById('attendanceRate');
            
            if (presentEl) presentEl.textContent = presentCount;
            if (absentEl) absentEl.textContent = absentCount;
            if (rateEl) rateEl.textContent = rate + '%';
        }
        
        // Save attendance
        function saveAttendance() {
            const weekNumber = parseInt(document.getElementById('weekSelector').value);
            const checkboxes = document.querySelectorAll('.attendance-checkbox');
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            
            // Remove old records for this week
            const filteredAttendance = attendance.filter(a => a.week !== weekNumber);
            
            // Add new records
            checkboxes.forEach(checkbox => {
                const studentCode = checkbox.dataset.studentCode;
                const isPresent = checkbox.checked;
                
                filteredAttendance.push({
                    studentCode: studentCode,
                    week: weekNumber,
                    present: isPresent,
                    recordedBy: currentUser ? currentUser.data.code || currentUser.data.username : 'ADMIN',
                    recordedAt: new Date().toISOString()
                });
            });
            
            if (saveToStorage(STORAGE_KEYS.ATTENDANCE, filteredAttendance)) {
                showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                updateDashboardStats();
            }
        }
        
        // Export attendance report
        function exportAttendanceReport() {
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            const weeks = generateTermWeeks();
            
            const reportData = students.map(student => {
                const row = {
                    'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³': student.code,
                    'Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³': student.name,
                    'Ø§Ù„ÙØµÙ„': student.className,
                    'Ø§Ù„Ù…Ø±Ø­Ù„Ø©': student.stage
                };
                
                let presentCount = 0;
                
                // Add attendance for each week
                for (let i = 1; i <= 15; i++) {
                    const record = attendance.find(a => 
                        a.studentCode === student.code && a.week === i
                    );
                    const isPresent = record ? record.present : false;
                    row[`Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i}`] = isPresent ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§Ø¦Ø¨';
                    if (isPresent) presentCount++;
                }
                
                row['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±'] = presentCount;
                row['Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±'] = Math.round((presentCount / 15) * 100) + '%';
                
                return row;
            });
            
            const ws = XLSX.utils.json_to_sheet(reportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Attendance Report');
            XLSX.writeFile(wb, `attendance_report_term1_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Grades Management
        function showGradesManagement() {
            const content = document.getElementById('adminContent');
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">ğŸ“ˆ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª - Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„</h3>
                            <p class="text-gray-600">10 ÙˆØ§Ø¬Ø¨Ø§Øª Ã— 10 Ø¯Ø±Ø¬Ø§Øª = Ø¥Ø¬Ù…Ø§Ù„ÙŠ 10 Ø¯Ø±Ø¬Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ©</p>
                        </div>
                    </div>
                    
                    <!-- Class Filter -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <label class="block text-sm font-bold text-gray-700 mb-3">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„</label>
                        <select id="gradesClassFilter" onchange="loadGradesTable()" class="w-full p-3 border-2 rounded-lg" style="border-color: var(--secondary-color)">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„</option>
                            ${CLASSES.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                        </select>
                    </div>
                    
                    <!-- Grades Table -->
                    <div id="gradesTableContainer" class="bg-white rounded-lg p-6 card-shadow">
                        <div class="text-center py-8 text-gray-500">
                            Ø§Ø®ØªØ± ÙØµÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                        </div>
                    </div>
                    
                    <!-- Save Button -->
                    <div class="flex justify-end gap-3">
                        <button onclick="saveAllGrades()" class="btn-success px-6 py-3 rounded-lg font-bold">
                            ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                        </button>
                        <button onclick="exportGradesReport()" class="btn-secondary px-6 py-3 rounded-lg font-bold">
                            ğŸ“Š ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                        </button>
                    </div>
                </div>
            `;
            
            loadGradesTable();
        }
        
        // Load Grades Table
        function loadGradesTable() {
            const classFilter = document.getElementById('gradesClassFilter').value;
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            let filteredStudents = students;
            if (classFilter) {
                filteredStudents = students.filter(s => s.className === classFilter);
            }
            
            filteredStudents.sort((a, b) => {
                if (a.className !== b.className) {
                    return a.className.localeCompare(b.className);
                }
                return a.name.localeCompare(b.name);
            });
            
            const container = document.getElementById('gradesTableContainer');
            
            if (filteredStudents.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙØµÙ„
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="mb-4">
                    <h4 class="text-xl font-bold mb-2" style="color: var(--primary-color)">
                        Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª - ${classFilter || 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„'}
                    </h4>
                    <p class="text-sm text-gray-600">
                        ğŸ“ ÙƒÙ„ ÙˆØ§Ø¬Ø¨ Ù…Ù† 10 Ø¯Ø±Ø¬Ø§Øª | ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ = Ù…ØªÙˆØ³Ø· Ø§Ù„Ù€ 10 ÙˆØ§Ø¬Ø¨Ø§Øª
                    </p>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-xs">
                        <thead style="background: var(--light-bg);">
                            <tr>
                                <th class="p-2 text-center sticky right-0 bg-white z-10" style="border: 2px solid var(--secondary-color);">Ù…</th>
                                <th class="p-2 text-right sticky right-0 bg-white z-10" style="border: 2px solid var(--secondary-color); min-width: 150px;">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                <th class="p-2 text-center" style="border: 2px solid var(--secondary-color);">Ø§Ù„ÙØµÙ„</th>
                                ${Array.from({length: 10}, (_, i) => `
                                    <th class="p-2 text-center" style="border: 2px solid var(--secondary-color); min-width: 70px;">
                                        ÙˆØ§Ø¬Ø¨ ${i + 1}
                                    </th>
                                `).join('')}
                                <th class="p-2 text-center sticky left-0 bg-white z-10" style="border: 2px solid var(--secondary-color); min-width: 80px;">
                                    Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredStudents.map((student, index) => {
                                const studentGrades = grades.filter(g => g.studentCode === student.code);
                                
                                let homeworkGrades = {};
                                studentGrades.forEach(g => {
                                    if (g.homeworkNumber) {
                                        homeworkGrades[g.homeworkNumber] = g.grade;
                                    }
                                });
                                
                                // Calculate total (average of all homeworks)
                                let totalGrades = 0;
                                let countedHomeworks = 0;
                                for (let i = 1; i <= 10; i++) {
                                    if (homeworkGrades[i] !== undefined && homeworkGrades[i] !== null && homeworkGrades[i] !== '') {
                                        totalGrades += parseFloat(homeworkGrades[i]) || 0;
                                        countedHomeworks++;
                                    }
                                }
                                const finalGrade = countedHomeworks > 0 ? (totalGrades / countedHomeworks).toFixed(1) : 0;
                                
                                return `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-2 text-center sticky right-0 bg-white" style="border: 1px solid #ddd;">${index + 1}</td>
                                        <td class="p-2 font-semibold sticky right-0 bg-white" style="border: 1px solid #ddd;">${student.name}</td>
                                        <td class="p-2 text-center" style="border: 1px solid #ddd;">${student.className}</td>
                                        ${Array.from({length: 10}, (_, i) => {
                                            const hwNum = i + 1;
                                            const grade = homeworkGrades[hwNum] !== undefined ? homeworkGrades[hwNum] : '';
                                            return `
                                                <td class="p-2 text-center" style="border: 1px solid #ddd;">
                                                    <input 
                                                        type="number" 
                                                        min="0" 
                                                        max="10" 
                                                        step="0.5"
                                                        value="${grade}"
                                                        class="grade-input w-full text-center"
                                                        data-student-code="${student.code}"
                                                        data-homework="${hwNum}"
                                                        onchange="updateGradeTotal()"
                                                        placeholder="0"
                                                    >
                                                </td>
                                            `;
                                        }).join('')}
                                        <td class="p-2 text-center font-bold sticky left-0 bg-white" style="border: 1px solid #ddd;">
                                            <span class="text-lg" style="color: ${finalGrade >= 8 ? 'var(--success-color)' : finalGrade >= 6 ? 'var(--warning-color)' : 'var(--danger-color)'}">
                                                ${finalGrade} / 10
                                            </span>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6 bg-blue-50 border-2 border-blue-300 rounded-lg p-4">
                    <h4 class="font-bold text-blue-800 mb-2">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©:</h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>â€¢ ÙƒÙ„ ÙˆØ§Ø¬Ø¨ ÙŠÙÙ‚ÙŠÙ‘Ù… Ù…Ù† 10 Ø¯Ø±Ø¬Ø§Øª</li>
                        <li>â€¢ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© = Ù…ØªÙˆØ³Ø· Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù€ 10 ÙˆØ§Ø¬Ø¨Ø§Øª</li>
                        <li>â€¢ ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø§Øª Ø¨ÙÙˆØ§ØµÙ„ Ø¹Ø´Ø±ÙŠØ© (Ù…Ø«Ø§Ù„: 8.5)</li>
                        <li>â€¢ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ = 8 ÙØ£ÙƒØ«Ø± | Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠØ© = 6-7.9 | Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ = Ø£Ù‚Ù„ Ù…Ù† 6</li>
                    </ul>
                </div>
            `;
        }
        
        // Update Grade Total
        function updateGradeTotal() {
            // This will be called when any grade input changes
            // The totals are recalculated in the display
        }
        
        // Save All Grades
        function saveAllGrades() {
            const gradeInputs = document.querySelectorAll('.grade-input');
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            // Remove old grade records for these students and homeworks
            const newGrades = [];
            
            gradeInputs.forEach(input => {
                const studentCode = input.dataset.studentCode;
                const homeworkNumber = parseInt(input.dataset.homework);
                const grade = parseFloat(input.value) || 0;
                
                if (input.value !== '') {
                    newGrades.push({
                        studentCode: studentCode,
                        homeworkNumber: homeworkNumber,
                        grade: grade,
                        maxGrade: 10,
                        recordedBy: currentUser ? currentUser.data.code || currentUser.data.username : 'ADMIN',
                        recordedAt: new Date().toISOString()
                    });
                }
            });
            
            // Merge with existing grades (remove duplicates)
            const existingGrades = grades.filter(g => {
                return !newGrades.some(ng => 
                    ng.studentCode === g.studentCode && ng.homeworkNumber === g.homeworkNumber
                );
            });
            
            const allGrades = [...existingGrades, ...newGrades];
            
            if (saveToStorage(STORAGE_KEYS.GRADES, allGrades)) {
                showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadGradesTable();
            }
        }
        
        // Export Grades Report
        function exportGradesReport() {
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            const reportData = students.map(student => {
                const row = {
                    'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³': student.code,
                    'Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³': student.name,
                    'Ø§Ù„ÙØµÙ„': student.className,
                    'Ø§Ù„Ù…Ø±Ø­Ù„Ø©': student.stage
                };
                
                const studentGrades = grades.filter(g => g.studentCode === student.code);
                let homeworkGrades = {};
                studentGrades.forEach(g => {
                    if (g.homeworkNumber) {
                        homeworkGrades[g.homeworkNumber] = g.grade;
                    }
                });
                
                // Add homework grades
                let totalGrades = 0;
                let countedHomeworks = 0;
                for (let i = 1; i <= 10; i++) {
                    const grade = homeworkGrades[i] !== undefined ? homeworkGrades[i] : 0;
                    row[`ÙˆØ§Ø¬Ø¨ ${i}`] = grade;
                    if (grade > 0) {
                        totalGrades += grade;
                        countedHomeworks++;
                    }
                }
                
                const finalGrade = countedHomeworks > 0 ? (totalGrades / countedHomeworks).toFixed(1) : 0;
                row['Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©'] = finalGrade;
                row['Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ù„Ù…Ø©'] = countedHomeworks;
                
                return row;
            });
            
            const ws = XLSX.utils.json_to_sheet(reportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Grades Report');
            XLSX.writeFile(wb, `grades_report_term1_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Backup Page
        function showBackupPage() {
            const content = document.getElementById('adminContent');
            
            content.innerHTML = `
                <div class="space-y-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</h3>
                    
                    <!-- Students Backup -->
                    <div class="backup-card bg-white rounded-lg p-6">
                        <div class="flex items-center mb-4">
                            <div class="text-3xl ml-3">ğŸ‘¥</div>
                            <h4 class="text-xl font-bold text-gray-800">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h4>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">ğŸ“¤ ØªØµØ¯ÙŠØ±</h5>
                                <div class="space-y-2">
                                    <button onclick="exportStudentsExcel()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                        ğŸ“Š ØªØµØ¯ÙŠØ± Excel
                                    </button>
                                    <button onclick="exportStudentsJSON()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                        ğŸ“„ ØªØµØ¯ÙŠØ± JSON
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</h5>
                                <div class="space-y-2">
                                    <button onclick="document.getElementById('importStudentsExcel').click()" class="w-full bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">
                                        ğŸ“Š Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel
                                    </button>
                                    <button onclick="document.getElementById('importStudentsJSON').click()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                        ğŸ“„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON
                                    </button>
                                    <input type="file" id="importStudentsExcel" accept=".xlsx,.xls" onchange="importStudentsExcel(event)" class="hidden">
                                    <input type="file" id="importStudentsJSON" accept=".json" onchange="importStudentsJSON(event)" class="hidden">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Teachers Backup -->
                    <div class="backup-card bg-white rounded-lg p-6">
                        <div class="flex items-center mb-4">
                            <div class="text-3xl ml-3">ğŸ‘¨â€ğŸ«</div>
                            <h4 class="text-xl font-bold text-gray-800">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ø®Ø¯Ø§Ù…</h4>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">ğŸ“¤ ØªØµØ¯ÙŠØ±</h5>
                                <div class="space-y-2">
                                    <button onclick="exportTeachersExcel()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                        ğŸ“Š ØªØµØ¯ÙŠØ± Excel
                                    </button>
                                    <button onclick="exportTeachersJSON()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                        ğŸ“„ ØªØµØ¯ÙŠØ± JSON
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</h5>
                                <div class="space-y-2">
                                    <button onclick="document.getElementById('importTeachersExcel').click()" class="w-full bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">
                                        ğŸ“Š Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel
                                    </button>
                                    <button onclick="document.getElementById('importTeachersJSON').click()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                        ğŸ“„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON
                                    </button>
                                    <input type="file" id="importTeachersExcel" accept=".xlsx,.xls" onchange="importTeachersExcel(event)" class="hidden">
                                    <input type="file" id="importTeachersJSON" accept=".json" onchange="importTeachersJSON(event)" class="hidden">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Full Backup -->
                    <div class="backup-card bg-white rounded-lg p-6">
                        <div class="flex items-center mb-4">
                            <div class="text-3xl ml-3">ğŸ—„ï¸</div>
                            <h4 class="text-xl font-bold text-gray-800">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙƒØ§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…</h4>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">ğŸ“¤ ØªØµØ¯ÙŠØ±</h5>
                                <div class="space-y-2">
                                    <button onclick="exportFullExcel()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                        ğŸ“Š ØªØµØ¯ÙŠØ± Excel ÙƒØ§Ù…Ù„
                                    </button>
                                    <button onclick="exportFullJSON()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                        ğŸ“„ ØªØµØ¯ÙŠØ± JSON ÙƒØ§Ù…Ù„
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</h5>
                                <div class="space-y-2">
                                    <button onclick="document.getElementById('importFullJSON').click()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                        ğŸ“„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON ÙƒØ§Ù…Ù„
                                    </button>
                                    <input type="file" id="importFullJSON" accept=".json" onchange="importFullJSON(event)" class="hidden">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Danger Zone -->
                    <div class="danger-zone rounded-lg p-6">
                        <div class="flex items-center mb-4">
                            <div class="text-3xl ml-3">âš ï¸</div>
                            <h4 class="text-xl font-bold text-red-800">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</h4>
                        </div>
                        <p class="text-red-700 mb-4">ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
                        <button onclick="deleteAllData()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors font-bold">
                            ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </div>
            `;
        }

        // Export Functions
        function exportStudentsExcel() {
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            
            if (students.length === 0) {
                showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† Ù„ØªØµØ¯ÙŠØ±Ù‡Ù…', 'error');
                return;
            }
            
            const ws = XLSX.utils.json_to_sheet(students);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Students');
            XLSX.writeFile(wb, `students_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function exportStudentsJSON() {
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            
            if (students.length === 0) {
                showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† Ù„ØªØµØ¯ÙŠØ±Ù‡Ù…', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(students, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `students_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function exportTeachersExcel() {
            const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
            
            if (teachers.length === 0) {
                showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø¯Ø§Ù… Ù„ØªØµØ¯ÙŠØ±Ù‡Ù…', 'error');
                return;
            }
            
            const ws = XLSX.utils.json_to_sheet(teachers);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Teachers');
            XLSX.writeFile(wb, `teachers_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function exportTeachersJSON() {
            const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
            
            if (teachers.length === 0) {
                showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø¯Ø§Ù… Ù„ØªØµØ¯ÙŠØ±Ù‡Ù…', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(teachers, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `teachers_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function exportFullExcel() {
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            const wb = XLSX.utils.book_new();
            
            if (students.length > 0) {
                const ws1 = XLSX.utils.json_to_sheet(students);
                XLSX.utils.book_append_sheet(wb, ws1, 'Students');
            }
            
            if (teachers.length > 0) {
                const ws2 = XLSX.utils.json_to_sheet(teachers);
                XLSX.utils.book_append_sheet(wb, ws2, 'Teachers');
            }
            
            if (attendance.length > 0) {
                const ws3 = XLSX.utils.json_to_sheet(attendance);
                XLSX.utils.book_append_sheet(wb, ws3, 'Attendance');
            }
            
            if (grades.length > 0) {
                const ws4 = XLSX.utils.json_to_sheet(grades);
                XLSX.utils.book_append_sheet(wb, ws4, 'Grades');
            }
            
            XLSX.writeFile(wb, `alhabeeb_full_backup_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function exportFullJSON() {
            const fullBackup = {
                students: loadFromStorage(STORAGE_KEYS.STUDENTS, []),
                teachers: loadFromStorage(STORAGE_KEYS.TEACHERS, []),
                attendance: loadFromStorage(STORAGE_KEYS.ATTENDANCE, []),
                grades: loadFromStorage(STORAGE_KEYS.GRADES, []),
                homework: loadFromStorage(STORAGE_KEYS.HOMEWORK, []),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(fullBackup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `alhabeeb_full_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Import Functions
        function importStudentsExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const students = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (saveToStorage(STORAGE_KEYS.STUDENTS, students)) {
                        showToast(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${students.length} Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                        showStudentsManagement();
                        updateDashboardStats();
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function importStudentsJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const students = JSON.parse(e.target.result);
                    
                    if (saveToStorage(STORAGE_KEYS.STUDENTS, students)) {
                        showToast(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${students.length} Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                        showStudentsManagement();
                        updateDashboardStats();
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsText(file);
        }

        function importTeachersExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const teachers = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (saveToStorage(STORAGE_KEYS.TEACHERS, teachers)) {
                        showToast(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${teachers.length} Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                        showTeachersManagement();
                        updateDashboardStats();
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function importTeachersJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const teachers = JSON.parse(e.target.result);
                    
                    if (saveToStorage(STORAGE_KEYS.TEACHERS, teachers)) {
                        showToast(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${teachers.length} Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                        showTeachersManagement();
                        updateDashboardStats();
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsText(file);
        }

        function importFullJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (backup.students) saveToStorage(STORAGE_KEYS.STUDENTS, backup.students);
                    if (backup.teachers) saveToStorage(STORAGE_KEYS.TEACHERS, backup.teachers);
                    if (backup.attendance) saveToStorage(STORAGE_KEYS.ATTENDANCE, backup.attendance);
                    if (backup.grades) saveToStorage(STORAGE_KEYS.GRADES, backup.grades);
                    if (backup.homework) saveToStorage(STORAGE_KEYS.HOMEWORK, backup.homework);
                    
                    showToast('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    updateDashboardStats();
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsText(file);
        }

        function deleteAllData() {
            const confirmation = prompt('Ù„Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§ÙƒØªØ¨ "DELETE" Ø¨Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„ÙƒØ¨ÙŠØ±Ø©:');
            
            if (confirmation === 'DELETE') {
                localStorage.removeItem(STORAGE_KEYS.STUDENTS);
                localStorage.removeItem(STORAGE_KEYS.TEACHERS);
                localStorage.removeItem(STORAGE_KEYS.ATTENDANCE);
                localStorage.removeItem(STORAGE_KEYS.GRADES);
                localStorage.removeItem(STORAGE_KEYS.HOMEWORK);
                
                showToast('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                updateDashboardStats();
                showBackupPage();
            } else {
                showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
            }
        }

        // Teacher Sections
        function showTeacherSection(section) {
            const content = document.getElementById('teacherContent');
            
            if (section === 'dashboard') {
                const teacher = currentUser.data;
                const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
                const homework = loadFromStorage(STORAGE_KEYS.HOMEWORK, []);
                const myStudents = students.filter(s => s.className === teacher.className);
                const pendingHomework = homework.filter(h => h.className === teacher.className && h.status === 'pending');
                
                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-green-50 rounded-lg p-6">
                            <h3 class="text-xl font-bold text-green-800 mb-4">ğŸ¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù…</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span>Ø§Ù„Ø§Ø³Ù…:</span>
                                    <span class="font-semibold">${teacher.name}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Ø§Ù„ØªØ®ØµØµ:</span>
                                    <span class="font-semibold">${teacher.specialty}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Ø§Ù„ÙØµÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span>
                                    <span class="font-semibold">${teacher.className || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</span>
                                    <span class="font-semibold">${myStudents.length}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
                                    <span class="font-semibold text-orange-600">${pendingHomework.length}</span>
                                </div>
                            </div>
                        </div>
                        
                        ${pendingHomework.length > 0 ? `
                            <div class="bg-orange-50 border-2 border-orange-300 rounded-lg p-6">
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="text-3xl">âš ï¸</span>
                                    <h3 class="text-xl font-bold text-orange-800">ØªÙ†Ø¨ÙŠÙ‡: ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                                </div>
                                <p class="text-orange-700 mb-4">
                                    Ù„Ø¯ÙŠÙƒ ${pendingHomework.length} ÙˆØ§Ø¬Ø¨ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù…Ù† Ø·Ù„Ø§Ø¨ ÙØµÙ„Ùƒ
                                </p>
                                <button onclick="showTeacherSection('homework')" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 font-bold">
                                    ğŸ“š Ø§Ù†ØªÙ‚Ù„ Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
                                </button>
                            </div>
                        ` : ''}
                        
                        <div class="grid md:grid-cols-3 gap-4">
                            <button onclick="showTeacherSection('attendance')" class="bg-white p-6 rounded-lg card-shadow hover-lift text-right">
                                <div class="text-3xl mb-2">âœ…</div>
                                <h4 class="font-bold text-gray-800">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h4>
                                <p class="text-sm text-gray-600">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± ÙˆØºÙŠØ§Ø¨ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                            </button>
                            
                            <button onclick="showTeacherSection('homework')" class="bg-white p-6 rounded-lg card-shadow hover-lift text-right">
                                <div class="text-3xl mb-2">ğŸ“š</div>
                                <h4 class="font-bold text-gray-800">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h4>
                                <p class="text-sm text-gray-600">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                                ${pendingHomework.length > 0 ? `
                                    <div class="mt-2">
                                        <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-bold">
                                            ${pendingHomework.length} Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                                        </span>
                                    </div>
                                ` : ''}
                            </button>
                            
                            <button onclick="showTeacherSection('grades')" class="bg-white p-6 rounded-lg card-shadow hover-lift text-right">
                                <div class="text-3xl mb-2">ğŸ“Š</div>
                                <h4 class="font-bold text-gray-800">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h4>
                                <p class="text-sm text-gray-600">Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                            </button>
                        </div>
                    </div>
                `;
            } else if (section === 'attendance') {
                showTeacherAttendance();
            } else if (section === 'homework') {
                showTeacherHomework();
            } else if (section === 'grades') {
                showTeacherGrades();
            } else if (section === 'students') {
                showTeacherStudents();
            }
        }
        
        // Show Teacher Homework
        function showTeacherHomework() {
            const content = document.getElementById('teacherContent');
            const teacher = currentUser.data;
            const homework = loadFromStorage(STORAGE_KEYS.HOMEWORK, []);
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            // Get homework for teacher's class
            const classHomework = homework.filter(h => h.className === teacher.className);
            
            // Separate pending and graded
            const pendingHomework = classHomework.filter(h => h.status === 'pending');
            const gradedHomework = classHomework.filter(h => h.status === 'graded');
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">ğŸ“š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª - ${teacher.className}</h3>
                            <p class="text-gray-600">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                        </div>
                    </div>
                    
                    <!-- Statistics Cards -->
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">ğŸ“š</div>
                            <h3 class="text-2xl font-bold text-blue-800">${classHomework.length}</h3>
                            <p class="text-blue-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">â³</div>
                            <h3 class="text-2xl font-bold text-orange-800">${pendingHomework.length}</h3>
                            <p class="text-orange-600 text-sm">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">âœ…</div>
                            <h3 class="text-2xl font-bold text-green-800">${gradedHomework.length}</h3>
                            <p class="text-green-600 text-sm">ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                        </div>
                    </div>
                    
                    <!-- Pending Homework -->
                    ${pendingHomework.length > 0 ? `
                        <div class="bg-white rounded-lg p-6 card-shadow">
                            <h3 class="text-xl font-bold mb-4 text-orange-800">
                                â³ ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (${pendingHomework.length})
                            </h3>
                            
                            <div class="space-y-4">
                                ${pendingHomework.sort((a, b) => new Date(a.submittedAt) - new Date(b.submittedAt)).map(hw => {
                                    const submittedDate = new Date(hw.submittedAt);
                                    
                                    return `
                                        <div class="border-2 border-orange-400 bg-orange-50 rounded-lg p-4">
                                            <div class="flex justify-between items-start mb-3">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-3 mb-2">
                                                        <span class="text-2xl">ğŸ“</span>
                                                        <div>
                                                            <h4 class="text-lg font-bold text-gray-800">
                                                                ${hw.studentName} - Ø§Ù„ÙˆØ§Ø¬Ø¨ ${hw.homeworkNumber}
                                                            </h4>
                                                            <p class="text-sm text-gray-600">
                                                                ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${submittedDate.toLocaleDateString('ar-EG')} - ${submittedDate.toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit'})}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="bg-white rounded-lg p-4 mt-3">
                                                        <h5 class="font-semibold text-gray-700 mb-2">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ§Ø¬Ø¨:</h5>
                                                        <p class="text-sm text-gray-700 whitespace-pre-wrap">${hw.content}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="flex justify-end gap-2 mt-4">
                                                <button onclick="gradeHomework('${hw.id}')" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 font-bold">
                                                    âœ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    ` : `
                        <div class="bg-white rounded-lg p-6 card-shadow">
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">âœ…</div>
                                <p class="text-gray-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                                <p class="text-gray-400 text-sm mt-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…ÙØ³Ù„Ù‘Ù…Ø© ØªÙ… ØªÙ‚ÙŠÙŠÙ…Ù‡Ø§</p>
                            </div>
                        </div>
                    `}
                    
                    <!-- Graded Homework -->
                    ${gradedHomework.length > 0 ? `
                        <div class="bg-white rounded-lg p-6 card-shadow">
                            <h3 class="text-xl font-bold mb-4 text-green-800">
                                âœ… ÙˆØ§Ø¬Ø¨Ø§Øª ØªÙ… ØªÙ‚ÙŠÙŠÙ…Ù‡Ø§ (${gradedHomework.length})
                            </h3>
                            
                            <div class="space-y-4">
                                ${gradedHomework.sort((a, b) => new Date(b.gradedAt) - new Date(a.gradedAt)).map(hw => {
                                    const submittedDate = new Date(hw.submittedAt);
                                    const gradedDate = new Date(hw.gradedAt);
                                    const studentGrade = grades.find(g => g.studentCode === hw.studentCode && g.homeworkNumber === hw.homeworkNumber);
                                    const grade = studentGrade ? studentGrade.grade : 0;
                                    
                                    return `
                                        <div class="border-2 rounded-lg p-4 ${
                                            grade >= 8 ? 'border-green-400 bg-green-50' : 
                                            grade >= 6 ? 'border-yellow-400 bg-yellow-50' : 
                                            'border-red-400 bg-red-50'
                                        }">
                                            <div class="flex justify-between items-start">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-3 mb-2">
                                                        <span class="text-2xl">
                                                            ${grade >= 8 ? 'ğŸŒŸ' : grade >= 6 ? 'â­' : 'ğŸ“'}
                                                        </span>
                                                        <div>
                                                            <h4 class="text-lg font-bold text-gray-800">
                                                                ${hw.studentName} - Ø§Ù„ÙˆØ§Ø¬Ø¨ ${hw.homeworkNumber}
                                                            </h4>
                                                            <p class="text-sm text-gray-600">
                                                                ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${submittedDate.toLocaleDateString('ar-EG')}
                                                            </p>
                                                            <p class="text-sm text-gray-600">
                                                                âœ… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${gradedDate.toLocaleDateString('ar-EG')}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-center mr-4">
                                                    <div class="text-3xl font-bold mb-1 ${
                                                        grade >= 8 ? 'text-green-700' :
                                                        grade >= 6 ? 'text-yellow-700' :
                                                        'text-red-700'
                                                    }">
                                                        ${grade} / 10
                                                    </div>
                                                    <div class="text-xs ${
                                                        grade >= 8 ? 'text-green-600' :
                                                        grade >= 6 ? 'text-yellow-600' :
                                                        'text-red-600'
                                                    }">
                                                        ${grade >= 8 ? 'Ù…Ù…ØªØ§Ø²' : grade >= 6 ? 'Ø¬ÙŠØ¯' : 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- Important Notes -->
                    <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-6">
                        <h3 class="text-lg font-bold text-blue-800 mb-3">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©</h3>
                        <ul class="space-y-2 text-sm text-blue-700">
                            <li>â€¢ Ù‚Ù… Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© ÙƒÙ„ ÙˆØ§Ø¬Ø¨ Ø¨Ø¹Ù†Ø§ÙŠØ© Ù‚Ø¨Ù„ Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø¬Ø©</li>
                            <li>â€¢ ÙƒÙ„ ÙˆØ§Ø¬Ø¨ ÙŠÙÙ‚ÙŠÙ‘Ù… Ù…Ù† 10 Ø¯Ø±Ø¬Ø§Øª</li>
                            <li>â€¢ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ø·Ø§Ù„Ø¨ = Ù…ØªÙˆØ³Ø· Ø¬Ù…ÙŠØ¹ ÙˆØ§Ø¬Ø¨Ø§ØªÙ‡</li>
                            <li>â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¤ÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙŠÙ‘Ù…Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹</li>
                            <li>â€¢ Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙˆØ±Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        // Grade Homework
        function gradeHomework(homeworkId) {
            const homework = loadFromStorage(STORAGE_KEYS.HOMEWORK, []);
            const hw = homework.find(h => h.id === homeworkId);
            
            if (!hw) {
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ø¨', 'error');
                return;
            }
            
            const modal = createModal(`ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨ ${hw.homeworkNumber} - ${hw.studentName}`, `
                <form id="gradeHomeworkForm" onsubmit="saveHomeworkGrade(event, '${homeworkId}')" class="space-y-4">
                    <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-4 mb-4">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">ğŸ“š</span>
                            <div>
                                <h4 class="font-bold text-blue-800">Ø§Ù„ÙˆØ§Ø¬Ø¨ ${hw.homeworkNumber}</h4>
                                <p class="text-sm text-blue-600">Ø§Ù„Ø·Ø§Ù„Ø¨: ${hw.studentName}</p>
                                <p class="text-sm text-blue-600">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${new Date(hw.submittedAt).toLocaleDateString('ar-EG')}</p>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg p-4">
                            <h5 class="font-semibold text-gray-700 mb-2">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ§Ø¬Ø¨:</h5>
                            <p class="text-sm text-gray-700 whitespace-pre-wrap max-h-60 overflow-y-auto">${hw.content}</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ù† 10) *</label>
                        <input 
                            type="number" 
                            name="grade" 
                            required 
                            min="0" 
                            max="10" 
                            step="0.5"
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-center text-2xl font-bold"
                            placeholder="0"
                            autofocus
                        >
                        <p class="text-xs text-gray-500 mt-1">
                            ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø§Øª Ø¨ÙÙˆØ§ØµÙ„ Ø¹Ø´Ø±ÙŠØ© (Ù…Ø«Ø§Ù„: 8.5)
                        </p>
                    </div>
                    
                    <div class="bg-green-50 border-2 border-green-300 rounded-lg p-4">
                        <h4 class="font-bold text-green-800 mb-2">ğŸ“Š Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h4>
                        <ul class="text-sm text-green-700 space-y-1">
                            <li>â€¢ 9-10: Ù…Ù…ØªØ§Ø² - Ø¥Ø¬Ø§Ø¨Ø© ÙƒØ§Ù…Ù„Ø© ÙˆØ¯Ù‚ÙŠÙ‚Ø©</li>
                            <li>â€¢ 8-8.9: Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ - Ø¥Ø¬Ø§Ø¨Ø© Ø¬ÙŠØ¯Ø© Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø³ÙŠØ·Ø©</li>
                            <li>â€¢ 6-7.9: Ø¬ÙŠØ¯ - Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø© Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ</li>
                            <li>â€¢ 4-5.9: Ù…Ù‚Ø¨ÙˆÙ„ - Ø¥Ø¬Ø§Ø¨Ø© Ù†Ø§Ù‚ØµØ©</li>
                            <li>â€¢ 0-3.9: Ø¶Ø¹ÙŠÙ - ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† ÙƒØ¨ÙŠØ±</li>
                        </ul>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal()" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-semibold">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                            âœ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                        </button>
                    </div>
                </form>
            `);
        }
        
        // Save Homework Grade
        function saveHomeworkGrade(event, homeworkId) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const grade = parseFloat(formData.get('grade'));
            
            if (grade < 0 || grade > 10) {
                showToast('Ø§Ù„Ø¯Ø±Ø¬Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0 Ùˆ 10', 'error');
                return;
            }
            
            const homework = loadFromStorage(STORAGE_KEYS.HOMEWORK, []);
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            const hw = homework.find(h => h.id === homeworkId);
            if (!hw) {
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ø¨', 'error');
                return;
            }
            
            // Update homework status
            hw.status = 'graded';
            hw.gradedAt = new Date().toISOString();
            hw.gradedBy = currentUser.data.code;
            
            // Add or update grade
            const existingGradeIndex = grades.findIndex(g => 
                g.studentCode === hw.studentCode && g.homeworkNumber === hw.homeworkNumber
            );
            
            const gradeRecord = {
                studentCode: hw.studentCode,
                homeworkNumber: hw.homeworkNumber,
                grade: grade,
                maxGrade: 10,
                recordedBy: currentUser.data.code,
                recordedAt: new Date().toISOString()
            };
            
            if (existingGradeIndex >= 0) {
                grades[existingGradeIndex] = gradeRecord;
            } else {
                grades.push(gradeRecord);
            }
            
            // Save both
            if (saveToStorage(STORAGE_KEYS.HOMEWORK, homework) && saveToStorage(STORAGE_KEYS.GRADES, grades)) {
                showToast(`âœ… ØªÙ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨ ${hw.homeworkNumber} Ù„Ù„Ø·Ø§Ù„Ø¨ ${hw.studentName} Ø¨Ø¯Ø±Ø¬Ø© ${grade}/10`, 'success');
                closeModal();
                showTeacherHomework();
            }
        }
        
        // Teacher Attendance
        function showTeacherAttendance() {
            const content = document.getElementById('teacherContent');
            const teacher = currentUser.data;
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            
            const myStudents = students.filter(s => s.className === teacher.className);
            const weeks = generateTermWeeks();
            const currentWeek = getCurrentWeek(weeks);
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± - ${teacher.className}</h3>
                            <p class="text-gray-600">15 Ø£Ø³Ø¨ÙˆØ¹ (5 Ø³Ø¨ØªÙ…Ø¨Ø± - 12 Ø¯ÙŠØ³Ù…Ø¨Ø± 2024)</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-600">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                            <div class="text-xl font-bold" style="color: var(--primary-color)">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${currentWeek}</div>
                        </div>
                    </div>
                    
                    <!-- Week Selector -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <label class="block text-sm font-bold text-gray-700 mb-3">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                        <select id="teacherWeekSelector" onchange="loadTeacherWeekAttendance()" class="w-full p-3 border-2 rounded-lg" style="border-color: var(--secondary-color)">
                            ${weeks.map((week, index) => `
                                <option value="${index + 1}" ${index + 1 === currentWeek ? 'selected' : ''}>
                                    Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${index + 1} (${week.start} - ${week.end})
                                </option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <!-- Attendance Table -->
                    <div id="teacherAttendanceTableContainer" class="bg-white rounded-lg p-6 card-shadow">
                        <div class="text-center py-8 text-gray-500">
                            Ø§Ø®ØªØ± Ø£Ø³Ø¨ÙˆØ¹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¶ÙˆØ±
                        </div>
                    </div>
                    
                    <!-- Save Button -->
                    <div class="flex justify-end">
                        <button onclick="saveTeacherAttendance()" class="btn-success px-6 py-3 rounded-lg font-bold">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±
                        </button>
                    </div>
                </div>
            `;
            
            loadTeacherWeekAttendance();
        }
        
        // Load Teacher Week Attendance
        function loadTeacherWeekAttendance() {
            const weekNumber = parseInt(document.getElementById('teacherWeekSelector').value);
            const teacher = currentUser.data;
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            const weeks = generateTermWeeks();
            const selectedWeek = weeks[weekNumber - 1];
            
            const myStudents = students.filter(s => s.className === teacher.className);
            myStudents.sort((a, b) => a.name.localeCompare(b.name));
            
            const today = new Date();
            const isEditingAllowed = today <= selectedWeek.endDate;
            
            const container = document.getElementById('teacherAttendanceTableContainer');
            
            if (myStudents.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ ÙØµÙ„Ùƒ
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="mb-4 flex justify-between items-center">
                    <h4 class="text-xl font-bold" style="color: var(--primary-color)">
                        Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${weekNumber} (${selectedWeek.start} - ${selectedWeek.end})
                    </h4>
                    ${!isEditingAllowed ? `
                        <div class="text-sm px-4 py-2 rounded-lg" style="background: #FFF3E0; color: #E65100;">
                            âš ï¸ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                        </div>
                    ` : ''}
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead style="background: var(--light-bg);">
                            <tr>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ù…</th>
                                <th class="p-3 text-right" style="border: 2px solid var(--secondary-color);">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                                <th class="p-3 text-center" style="border: 2px solid var(--secondary-color);">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${myStudents.map((student, index) => {
                                const attendanceRecord = attendance.find(a => 
                                    a.studentCode === student.code && a.week === weekNumber
                                );
                                const isPresent = attendanceRecord ? attendanceRecord.present : false;
                                
                                return `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3 text-center" style="border: 1px solid #ddd;">${index + 1}</td>
                                        <td class="p-3 font-semibold" style="border: 1px solid #ddd;">${student.name}</td>
                                        <td class="p-3 text-center text-xs" style="border: 1px solid #ddd;">${student.stage}</td>
                                        <td class="p-3 text-center" style="border: 1px solid #ddd;">
                                            <input 
                                                type="checkbox" 
                                                class="teacher-attendance-checkbox" 
                                                data-student-code="${student.code}"
                                                data-week="${weekNumber}"
                                                ${isPresent ? 'checked' : ''}
                                                ${!isEditingAllowed ? 'disabled' : ''}
                                                onchange="updateTeacherAttendanceStatus()"
                                            >
                                        </td>
                                        <td class="p-3 text-center" style="border: 1px solid #ddd;">
                                            <span class="status-badge ${isPresent ? 'status-present' : 'status-absent'}">
                                                ${isPresent ? 'âœ“ Ø­Ø§Ø¶Ø±' : 'âœ— ØºØ§Ø¦Ø¨'}
                                            </span>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6 grid md:grid-cols-3 gap-4">
                    <div class="bg-green-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-800" id="teacherPresentCount">0</div>
                        <div class="text-sm text-green-600">Ø­Ø§Ø¶Ø±</div>
                    </div>
                    <div class="bg-red-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-red-800" id="teacherAbsentCount">0</div>
                        <div class="text-sm text-red-600">ØºØ§Ø¦Ø¨</div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-800" id="teacherAttendanceRate">0%</div>
                        <div class="text-sm text-blue-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                    </div>
                </div>
            `;
            
            updateTeacherAttendanceStatus();
        }
        
        // Update Teacher Attendance Status
        function updateTeacherAttendanceStatus() {
            const checkboxes = document.querySelectorAll('.teacher-attendance-checkbox');
            let presentCount = 0;
            let totalCount = checkboxes.length;
            
            checkboxes.forEach(cb => {
                if (cb.checked) presentCount++;
            });
            
            const absentCount = totalCount - presentCount;
            const rate = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
            
            const presentEl = document.getElementById('teacherPresentCount');
            const absentEl = document.getElementById('teacherAbsentCount');
            const rateEl = document.getElementById('teacherAttendanceRate');
            
            if (presentEl) presentEl.textContent = presentCount;
            if (absentEl) absentEl.textContent = absentCount;
            if (rateEl) rateEl.textContent = rate + '%';
        }
        
        // Save Teacher Attendance
        function saveTeacherAttendance() {
            const weekNumber = parseInt(document.getElementById('teacherWeekSelector').value);
            const checkboxes = document.querySelectorAll('.teacher-attendance-checkbox');
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            
            // Remove old records for this week and these students
            const studentCodes = Array.from(checkboxes).map(cb => cb.dataset.studentCode);
            const filteredAttendance = attendance.filter(a => 
                !(a.week === weekNumber && studentCodes.includes(a.studentCode))
            );
            
            // Add new records
            checkboxes.forEach(checkbox => {
                const studentCode = checkbox.dataset.studentCode;
                const isPresent = checkbox.checked;
                
                filteredAttendance.push({
                    studentCode: studentCode,
                    week: weekNumber,
                    present: isPresent,
                    recordedBy: currentUser.data.code,
                    recordedAt: new Date().toISOString()
                });
            });
            
            if (saveToStorage(STORAGE_KEYS.ATTENDANCE, filteredAttendance)) {
                showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }
        
        // Teacher Grades
        function showTeacherGrades() {
            const content = document.getElementById('teacherContent');
            const teacher = currentUser.data;
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            const myStudents = students.filter(s => s.className === teacher.className);
            myStudents.sort((a, b) => a.name.localeCompare(b.name));
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">ğŸ“Š Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª - ${teacher.className}</h3>
                            <p class="text-gray-600">10 ÙˆØ§Ø¬Ø¨Ø§Øª Ã— 10 Ø¯Ø±Ø¬Ø§Øª = Ø¥Ø¬Ù…Ø§Ù„ÙŠ 10 Ø¯Ø±Ø¬Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ©</p>
                        </div>
                    </div>
                    
                    <!-- Grades Table -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        ${myStudents.length === 0 ? `
                            <div class="text-center py-8 text-gray-500">
                                Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ ÙØµÙ„Ùƒ
                            </div>
                        ` : `
                            <div class="mb-4">
                                <h4 class="text-xl font-bold mb-2" style="color: var(--primary-color)">
                                    Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª - ${teacher.className}
                                </h4>
                                <p class="text-sm text-gray-600">
                                    ğŸ“ ÙƒÙ„ ÙˆØ§Ø¬Ø¨ Ù…Ù† 10 Ø¯Ø±Ø¬Ø§Øª | ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ = Ù…ØªÙˆØ³Ø· Ø§Ù„Ù€ 10 ÙˆØ§Ø¬Ø¨Ø§Øª
                                </p>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full text-xs">
                                    <thead style="background: var(--light-bg);">
                                        <tr>
                                            <th class="p-2 text-center sticky right-0 bg-white z-10" style="border: 2px solid var(--secondary-color);">Ù…</th>
                                            <th class="p-2 text-right sticky right-0 bg-white z-10" style="border: 2px solid var(--secondary-color); min-width: 150px;">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                            ${Array.from({length: 10}, (_, i) => `
                                                <th class="p-2 text-center" style="border: 2px solid var(--secondary-color); min-width: 70px;">
                                                    ÙˆØ§Ø¬Ø¨ ${i + 1}
                                                </th>
                                            `).join('')}
                                            <th class="p-2 text-center sticky left-0 bg-white z-10" style="border: 2px solid var(--secondary-color); min-width: 80px;">
                                                Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${myStudents.map((student, index) => {
                                            const studentGrades = grades.filter(g => g.studentCode === student.code);
                                            
                                            let homeworkGrades = {};
                                            studentGrades.forEach(g => {
                                                if (g.homeworkNumber) {
                                                    homeworkGrades[g.homeworkNumber] = g.grade;
                                                }
                                            });
                                            
                                            // Calculate total (average of all homeworks)
                                            let totalGrades = 0;
                                            let countedHomeworks = 0;
                                            for (let i = 1; i <= 10; i++) {
                                                if (homeworkGrades[i] !== undefined && homeworkGrades[i] !== null && homeworkGrades[i] !== '') {
                                                    totalGrades += parseFloat(homeworkGrades[i]) || 0;
                                                    countedHomeworks++;
                                                }
                                            }
                                            const finalGrade = countedHomeworks > 0 ? (totalGrades / countedHomeworks).toFixed(1) : 0;
                                            
                                            return `
                                                <tr class="border-b hover:bg-gray-50">
                                                    <td class="p-2 text-center sticky right-0 bg-white" style="border: 1px solid #ddd;">${index + 1}</td>
                                                    <td class="p-2 font-semibold sticky right-0 bg-white" style="border: 1px solid #ddd;">${student.name}</td>
                                                    ${Array.from({length: 10}, (_, i) => {
                                                        const hwNum = i + 1;
                                                        const grade = homeworkGrades[hwNum] !== undefined ? homeworkGrades[hwNum] : '';
                                                        return `
                                                            <td class="p-2 text-center" style="border: 1px solid #ddd;">
                                                                <input 
                                                                    type="number" 
                                                                    min="0" 
                                                                    max="10" 
                                                                    step="0.5"
                                                                    value="${grade}"
                                                                    class="teacher-grade-input w-full text-center"
                                                                    data-student-code="${student.code}"
                                                                    data-homework="${hwNum}"
                                                                    placeholder="0"
                                                                >
                                                            </td>
                                                        `;
                                                    }).join('')}
                                                    <td class="p-2 text-center font-bold sticky left-0 bg-white" style="border: 1px solid #ddd;">
                                                        <span class="text-lg" style="color: ${finalGrade >= 8 ? 'var(--success-color)' : finalGrade >= 6 ? 'var(--warning-color)' : 'var(--danger-color)'}">
                                                            ${finalGrade} / 10
                                                        </span>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="mt-6 bg-blue-50 border-2 border-blue-300 rounded-lg p-4">
                                <h4 class="font-bold text-blue-800 mb-2">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©:</h4>
                                <ul class="text-sm text-blue-700 space-y-1">
                                    <li>â€¢ ÙƒÙ„ ÙˆØ§Ø¬Ø¨ ÙŠÙÙ‚ÙŠÙ‘Ù… Ù…Ù† 10 Ø¯Ø±Ø¬Ø§Øª</li>
                                    <li>â€¢ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© = Ù…ØªÙˆØ³Ø· Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù€ 10 ÙˆØ§Ø¬Ø¨Ø§Øª</li>
                                    <li>â€¢ ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø§Øª Ø¨ÙÙˆØ§ØµÙ„ Ø¹Ø´Ø±ÙŠØ© (Ù…Ø«Ø§Ù„: 8.5)</li>
                                    <li>â€¢ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ = 8 ÙØ£ÙƒØ«Ø± | Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠØ© = 6-7.9 | Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ = Ø£Ù‚Ù„ Ù…Ù† 6</li>
                                </ul>
                            </div>
                        `}
                    </div>
                    
                    <!-- Save Button -->
                    ${myStudents.length > 0 ? `
                        <div class="flex justify-end">
                            <button onclick="saveTeacherGrades()" class="btn-success px-6 py-3 rounded-lg font-bold">
                                ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        // Save Teacher Grades
        function saveTeacherGrades() {
            const gradeInputs = document.querySelectorAll('.teacher-grade-input');
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            const newGrades = [];
            
            gradeInputs.forEach(input => {
                const studentCode = input.dataset.studentCode;
                const homeworkNumber = parseInt(input.dataset.homework);
                const grade = parseFloat(input.value) || 0;
                
                if (input.value !== '') {
                    newGrades.push({
                        studentCode: studentCode,
                        homeworkNumber: homeworkNumber,
                        grade: grade,
                        maxGrade: 10,
                        recordedBy: currentUser.data.code,
                        recordedAt: new Date().toISOString()
                    });
                }
            });
            
            // Merge with existing grades (remove duplicates)
            const existingGrades = grades.filter(g => {
                return !newGrades.some(ng => 
                    ng.studentCode === g.studentCode && ng.homeworkNumber === g.homeworkNumber
                );
            });
            
            const allGrades = [...existingGrades, ...newGrades];
            
            if (saveToStorage(STORAGE_KEYS.GRADES, allGrades)) {
                showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                showTeacherGrades();
            }
        }
        
        // Teacher Students
        function showTeacherStudents() {
            const content = document.getElementById('teacherContent');
            const teacher = currentUser.data;
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            
            const myStudents = students.filter(s => s.className === teacher.className);
            myStudents.sort((a, b) => a.name.localeCompare(b.name));
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800">ğŸ‘¥ Ø·Ù„Ø§Ø¨ÙŠ - ${teacher.className}</h3>
                        <p class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${myStudents.length} Ø¯Ø§Ø±Ø³</p>
                    </div>
                    
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        ${myStudents.length === 0 ? `
                            <div class="text-center py-8 text-gray-500">
                                Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ ÙØµÙ„Ùƒ
                            </div>
                        ` : `
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="p-3 text-center">Ù…</th>
                                            <th class="p-3 text-right">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                            <th class="p-3 text-center">Ø§Ù„Ù†ÙˆØ¹</th>
                                            <th class="p-3 text-center">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                            <th class="p-3 text-center">Ø§Ù„Ù‡Ø§ØªÙ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${myStudents.map((student, index) => `
                                            <tr class="border-b hover:bg-gray-50">
                                                <td class="p-3 text-center">${index + 1}</td>
                                                <td class="p-3 font-semibold">${student.name}</td>
                                                <td class="p-3 text-center">${student.gender}</td>
                                                <td class="p-3 text-center text-xs">${student.stage}</td>
                                                <td class="p-3 text-center text-xs">${student.phone1}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Student Sections
        function showStudentSection(section) {
            const content = document.getElementById('studentContent');
            
            if (section === 'profile') {
                const student = currentUser.data;
                
                content.innerHTML = `
                    <div class="bg-purple-50 rounded-lg p-6">
                        <h3 class="text-xl font-bold text-purple-800 mb-4">ğŸ‘¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Ø§Ù„Ø§Ø³Ù…:</span>
                                <span class="font-semibold">${student.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³:</span>
                                <span class="font-semibold font-mono">${student.code}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Ø§Ù„Ù†ÙˆØ¹:</span>
                                <span class="font-semibold">${student.gender}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Ø§Ù„Ù…Ø±Ø­Ù„Ø©:</span>
                                <span class="font-semibold">${student.stage}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Ø§Ù„ÙØµÙ„:</span>
                                <span class="font-semibold">${student.className}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
                                <span class="font-semibold">${student.phone1}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else if (section === 'attendance') {
                showStudentAttendance();
            } else if (section === 'grades') {
                showStudentGrades();
            } else if (section === 'homework') {
                showStudentHomework();
            }
        }
        
        // Show Student Homework
        function showStudentHomework() {
            const content = document.getElementById('studentContent');
            const student = currentUser.data;
            const homework = loadFromStorage(STORAGE_KEYS.HOMEWORK, []);
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            // Get student's homework submissions
            const studentHomework = homework.filter(h => h.studentCode === student.code);
            
            // Get student's grades
            const studentGrades = grades.filter(g => g.studentCode === student.code);
            let homeworkGrades = {};
            studentGrades.forEach(g => {
                if (g.homeworkNumber) {
                    homeworkGrades[g.homeworkNumber] = g.grade;
                }
            });
            
            // Calculate statistics
            const submittedCount = studentHomework.length;
            const gradedCount = Object.keys(homeworkGrades).length;
            const pendingCount = submittedCount - gradedCount;
            const remainingCount = 10 - submittedCount;
            
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Statistics Cards -->
                    <div class="grid md:grid-cols-4 gap-4">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">ğŸ“š</div>
                            <h3 class="text-2xl font-bold text-blue-800">${submittedCount}</h3>
                            <p class="text-blue-600 text-sm">ÙˆØ§Ø¬Ø¨Ø§Øª Ù…ÙØ³Ù„Ù‘Ù…Ø©</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">âœ…</div>
                            <h3 class="text-2xl font-bold text-green-800">${gradedCount}</h3>
                            <p class="text-green-600 text-sm">ÙˆØ§Ø¬Ø¨Ø§Øª Ù…ÙÙ‚ÙŠÙ‘Ù…Ø©</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">â³</div>
                            <h3 class="text-2xl font-bold text-yellow-800">${pendingCount}</h3>
                            <p class="text-yellow-600 text-sm">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">ğŸ“</div>
                            <h3 class="text-2xl font-bold text-red-800">${remainingCount}</h3>
                            <p class="text-red-600 text-sm">ÙˆØ§Ø¬Ø¨Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©</p>
                        </div>
                    </div>
                    
                    <!-- Add Homework Button -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold" style="color: var(--primary-color)">
                                ğŸ“ ØªØ³Ù„ÙŠÙ… ÙˆØ§Ø¬Ø¨ Ø¬Ø¯ÙŠØ¯
                            </h3>
                            <button onclick="showAddHomeworkForm()" class="btn-primary px-6 py-3 rounded-lg font-bold">
                                â• Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨
                            </button>
                        </div>
                        <p class="text-sm text-gray-600">
                            ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ù„ÙŠÙ… Ø­ØªÙ‰ 10 ÙˆØ§Ø¬Ø¨Ø§Øª Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ±Ù…. Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ù„Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„ØªÙ‚ÙŠÙŠÙ…Ù‡.
                        </p>
                    </div>
                    
                    <!-- Homework List -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color)">
                            ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…ÙØ³Ù„Ù‘Ù…Ø©
                        </h3>
                        
                        ${studentHomework.length === 0 ? `
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">ğŸ“š</div>
                                <p class="text-gray-500 text-lg">Ù„Ù… ØªÙ‚Ù… Ø¨ØªØ³Ù„ÙŠÙ… Ø£ÙŠ ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>
                                <p class="text-gray-400 text-sm mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨Ùƒ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¢Ù†!</p>
                            </div>
                        ` : `
                            <div class="space-y-4">
                                ${studentHomework.sort((a, b) => b.homeworkNumber - a.homeworkNumber).map(hw => {
                                    const grade = homeworkGrades[hw.homeworkNumber];
                                    const hasGrade = grade !== undefined && grade !== null;
                                    const submittedDate = new Date(hw.submittedAt);
                                    
                                    return `
                                        <div class="border-2 rounded-lg p-4 ${
                                            hasGrade ? 
                                                (grade >= 8 ? 'border-green-400 bg-green-50' : 
                                                 grade >= 6 ? 'border-yellow-400 bg-yellow-50' : 
                                                 'border-red-400 bg-red-50') 
                                            : 'border-blue-400 bg-blue-50'
                                        }">
                                            <div class="flex justify-between items-start mb-3">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-3 mb-2">
                                                        <span class="text-2xl">
                                                            ${hasGrade ? 
                                                                (grade >= 8 ? 'ğŸŒŸ' : grade >= 6 ? 'â­' : 'ğŸ“') 
                                                            : 'â³'}
                                                        </span>
                                                        <h4 class="text-lg font-bold text-gray-800">
                                                            Ø§Ù„ÙˆØ§Ø¬Ø¨ ${hw.homeworkNumber}
                                                        </h4>
                                                        <span class="status-badge ${
                                                            hasGrade ? 'status-present' : 'bg-blue-100 text-blue-800'
                                                        }">
                                                            ${hasGrade ? 'ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…' : 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}
                                                        </span>
                                                    </div>
                                                    <p class="text-sm text-gray-600 mb-2">
                                                        ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${submittedDate.toLocaleDateString('ar-EG')} - ${submittedDate.toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit'})}
                                                    </p>
                                                    <div class="bg-white rounded-lg p-3 mt-2">
                                                        <p class="text-sm text-gray-700 whitespace-pre-wrap">${hw.content}</p>
                                                    </div>
                                                </div>
                                                ${hasGrade ? `
                                                    <div class="text-center mr-4">
                                                        <div class="text-3xl font-bold mb-1 ${
                                                            grade >= 8 ? 'text-green-700' :
                                                            grade >= 6 ? 'text-yellow-700' :
                                                            'text-red-700'
                                                        }">
                                                            ${grade} / 10
                                                        </div>
                                                        <div class="text-xs ${
                                                            grade >= 8 ? 'text-green-600' :
                                                            grade >= 6 ? 'text-yellow-600' :
                                                            'text-red-600'
                                                        }">
                                                            ${grade >= 8 ? 'Ù…Ù…ØªØ§Ø²' : grade >= 6 ? 'Ø¬ÙŠØ¯' : 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'}
                                                        </div>
                                                    </div>
                                                ` : ''}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `}
                    </div>
                    
                    <!-- Important Notes -->
                    <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-6">
                        <h3 class="text-lg font-bold text-blue-800 mb-3">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©</h3>
                        <ul class="space-y-2 text-sm text-blue-700">
                            <li>â€¢ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ù„ÙŠÙ… Ø­ØªÙ‰ 10 ÙˆØ§Ø¬Ø¨Ø§Øª Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ±Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</li>
                            <li>â€¢ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ÙØµÙ„Ùƒ</li>
                            <li>â€¢ Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨ ÙˆØ¥Ø¹Ø·Ø§Ø¦Ùƒ Ø¯Ø±Ø¬Ø© Ù…Ù† 10</li>
                            <li>â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨ (Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… / ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…)</li>
                            <li>â€¢ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© = Ù…ØªÙˆØ³Ø· Ø¯Ø±Ø¬Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙŠÙ‘Ù…Ø©</li>
                            <li>â€¢ Ø§Ø­Ø±Øµ Ø¹Ù„Ù‰ ØªØ³Ù„ÙŠÙ… ÙˆØ§Ø¬Ø¨Ø§ØªÙƒ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯</li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        // Show Add Homework Form
        function showAddHomeworkForm() {
            const student = currentUser.data;
            const homework = loadFromStorage(STORAGE_KEYS.HOMEWORK, []);
            const studentHomework = homework.filter(h => h.studentCode === student.code);
            
            if (studentHomework.length >= 10) {
                showToast('Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª (10 ÙˆØ§Ø¬Ø¨Ø§Øª)', 'error');
                return;
            }
            
            // Find next homework number
            const submittedNumbers = studentHomework.map(h => h.homeworkNumber);
            let nextNumber = 1;
            for (let i = 1; i <= 10; i++) {
                if (!submittedNumbers.includes(i)) {
                    nextNumber = i;
                    break;
                }
            }
            
            const modal = createModal('ğŸ“ ØªØ³Ù„ÙŠÙ… ÙˆØ§Ø¬Ø¨ Ø¬Ø¯ÙŠØ¯', `
                <form id="addHomeworkForm" onsubmit="submitHomework(event)" class="space-y-4">
                    <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-4 mb-4">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">ğŸ“š</span>
                            <div>
                                <h4 class="font-bold text-blue-800">Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø±Ù‚Ù… ${nextNumber}</h4>
                                <p class="text-sm text-blue-600">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø®Ø§Ø¯Ù…: ${student.className}</p>
                            </div>
                        </div>
                    </div>
                    
                    <input type="hidden" name="homeworkNumber" value="${nextNumber}">
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ§Ø¬Ø¨ *</label>
                        <textarea 
                            name="content" 
                            required 
                            rows="8"
                            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ù‡Ù†Ø§...&#10;&#10;ÙŠÙ…ÙƒÙ†Ùƒ ÙƒØªØ§Ø¨Ø©:&#10;â€¢ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©&#10;â€¢ Ù…Ù„Ø®ØµØ§Øª Ø§Ù„Ø¯Ø±ÙˆØ³&#10;â€¢ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©&#10;â€¢ Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ…ÙŠ Ø¢Ø®Ø±"
                        ></textarea>
                        <p class="text-xs text-gray-500 mt-1">
                            ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¨ÙˆØ¶ÙˆØ­ ÙˆØ¨Ø®Ø· Ù…Ø±ØªØ¨
                        </p>
                    </div>
                    
                    <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                        <h4 class="font-bold text-yellow-800 mb-2">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</li>
                            <li>â€¢ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</li>
                            <li>â€¢ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨ ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</li>
                        </ul>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal()" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-semibold">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">
                            ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨
                        </button>
                    </div>
                </form>
            `);
        }
        
        // Submit Homework
        function submitHomework(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const student = currentUser.data;
            const homework = loadFromStorage(STORAGE_KEYS.HOMEWORK, []);
            
            const newHomework = {
                id: generateCode('HW'),
                studentCode: student.code,
                studentName: student.name,
                className: student.className,
                homeworkNumber: parseInt(formData.get('homeworkNumber')),
                content: formData.get('content'),
                submittedAt: new Date().toISOString(),
                status: 'pending' // pending, graded
            };
            
            homework.push(newHomework);
            
            if (saveToStorage(STORAGE_KEYS.HOMEWORK, homework)) {
                showToast(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨ ${newHomework.homeworkNumber} Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù„Ø®Ø§Ø¯Ù…`, 'success');
                closeModal();
                showStudentHomework();
            }
        }
        
        // Show Student Grades
        function showStudentGrades() {
            const content = document.getElementById('studentContent');
            const student = currentUser.data;
            const grades = loadFromStorage(STORAGE_KEYS.GRADES, []);
            
            // Get student's grades
            const studentGrades = grades.filter(g => g.studentCode === student.code);
            
            let homeworkGrades = {};
            studentGrades.forEach(g => {
                if (g.homeworkNumber) {
                    homeworkGrades[g.homeworkNumber] = g.grade;
                }
            });
            
            // Calculate statistics
            let totalGrades = 0;
            let countedHomeworks = 0;
            for (let i = 1; i <= 10; i++) {
                if (homeworkGrades[i] !== undefined && homeworkGrades[i] !== null && homeworkGrades[i] !== '') {
                    totalGrades += parseFloat(homeworkGrades[i]) || 0;
                    countedHomeworks++;
                }
            }
            const finalGrade = countedHomeworks > 0 ? (totalGrades / countedHomeworks).toFixed(1) : 0;
            const remainingHomeworks = 10 - countedHomeworks;
            
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Statistics Cards -->
                    <div class="grid md:grid-cols-4 gap-4">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">ğŸ“š</div>
                            <h3 class="text-2xl font-bold text-blue-800">10</h3>
                            <p class="text-blue-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">âœ…</div>
                            <h3 class="text-2xl font-bold text-green-800">${countedHomeworks}</h3>
                            <p class="text-green-600 text-sm">ÙˆØ§Ø¬Ø¨Ø§Øª Ù…ÙÙ‚ÙŠÙ‘Ù…Ø©</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">â³</div>
                            <h3 class="text-2xl font-bold text-yellow-800">${remainingHomeworks}</h3>
                            <p class="text-yellow-600 text-sm">ÙˆØ§Ø¬Ø¨Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">ğŸ¯</div>
                            <h3 class="text-2xl font-bold text-purple-800">${finalGrade}</h3>
                            <p class="text-purple-600 text-sm">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© / 10</p>
                        </div>
                    </div>
                    
                    <!-- Grade Status Message -->
                    <div class="rounded-lg p-6 text-center ${
                        finalGrade >= 8 ? 'bg-green-50 border-2 border-green-300' :
                        finalGrade >= 6 ? 'bg-yellow-50 border-2 border-yellow-300' :
                        finalGrade > 0 ? 'bg-red-50 border-2 border-red-300' :
                        'bg-gray-50 border-2 border-gray-300'
                    }">
                        <div class="text-4xl mb-3">
                            ${finalGrade >= 8 ? 'ğŸŒŸ' : finalGrade >= 6 ? 'âš ï¸' : finalGrade > 0 ? 'ğŸš¨' : 'ğŸ“'}
                        </div>
                        <h3 class="text-xl font-bold mb-2 ${
                            finalGrade >= 8 ? 'text-green-800' :
                            finalGrade >= 6 ? 'text-yellow-800' :
                            finalGrade > 0 ? 'text-red-800' :
                            'text-gray-800'
                        }">
                            ${
                                finalGrade >= 8 ? 'Ù…Ù…ØªØ§Ø²! Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹' :
                                finalGrade >= 6 ? 'Ø¬ÙŠØ¯! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø³ÙŠÙ†' :
                                finalGrade > 0 ? 'ØªØ­Ø°ÙŠØ±! ÙŠØ¬Ø¨ ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¦Ùƒ' :
                                'Ù„Ù… ÙŠØªÙ… ØªÙ‚ÙŠÙŠÙ… Ø£ÙŠ ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø¹Ø¯'
                            }
                        </h3>
                        <p class="text-sm ${
                            finalGrade >= 8 ? 'text-green-700' :
                            finalGrade >= 6 ? 'text-yellow-700' :
                            finalGrade > 0 ? 'text-red-700' :
                            'text-gray-700'
                        }">
                            ${
                                finalGrade >= 8 ? 'Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ù…Ù…ØªØ§Ø²' :
                                finalGrade >= 6 ? 'Ø­Ø§ÙˆÙ„ Ø¨Ø°Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø¯ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©' :
                                finalGrade > 0 ? 'ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¦Ùƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø§Øª Ø£ÙØ¶Ù„' :
                                'Ø§Ø¨Ø¯Ø£ Ø¨ØªØ³Ù„ÙŠÙ… ÙˆØ§Ø¬Ø¨Ø§ØªÙƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'
                            }
                        </p>
                    </div>
                    
                    <!-- Homework Grades Details -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color)">
                            ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            ${Array.from({length: 10}, (_, i) => {
                                const hwNum = i + 1;
                                const grade = homeworkGrades[hwNum];
                                const hasGrade = grade !== undefined && grade !== null && grade !== '';
                                
                                return `
                                    <div class="border-2 rounded-lg p-4 ${
                                        hasGrade ? 
                                            (grade >= 8 ? 'border-green-400 bg-green-50' : 
                                             grade >= 6 ? 'border-yellow-400 bg-yellow-50' : 
                                             'border-red-400 bg-red-50') 
                                        : 'border-gray-300 bg-gray-50'
                                    }">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-bold text-gray-700">Ø§Ù„ÙˆØ§Ø¬Ø¨ ${hwNum}</span>
                                            <span class="text-2xl">
                                                ${hasGrade ? 
                                                    (grade >= 8 ? 'ğŸŒŸ' : grade >= 6 ? 'â­' : 'ğŸ“') 
                                                : 'â³'}
                                            </span>
                                        </div>
                                        <div class="text-center">
                                            ${hasGrade ? `
                                                <div class="text-3xl font-bold mb-1 ${
                                                    grade >= 8 ? 'text-green-700' :
                                                    grade >= 6 ? 'text-yellow-700' :
                                                    'text-red-700'
                                                }">
                                                    ${grade} / 10
                                                </div>
                                                <div class="text-xs ${
                                                    grade >= 8 ? 'text-green-600' :
                                                    grade >= 6 ? 'text-yellow-600' :
                                                    'text-red-600'
                                                }">
                                                    ${grade >= 8 ? 'Ù…Ù…ØªØ§Ø²' : grade >= 6 ? 'Ø¬ÙŠØ¯' : 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'}
                                                </div>
                                            ` : `
                                                <div class="text-sm text-gray-600">
                                                    Ù„Ù… ÙŠÙÙ‚ÙŠÙ‘Ù… Ø¨Ø¹Ø¯
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- Grade Chart -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color)">
                            ğŸ“ˆ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø¯Ø±Ø¬Ø§Øª
                        </h3>
                        <div class="space-y-3">
                            ${Array.from({length: 10}, (_, i) => {
                                const hwNum = i + 1;
                                const grade = homeworkGrades[hwNum] || 0;
                                const percentage = (grade / 10) * 100;
                                
                                return `
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm font-semibold text-gray-700">Ø§Ù„ÙˆØ§Ø¬Ø¨ ${hwNum}</span>
                                            <span class="text-sm font-semibold ${
                                                grade >= 8 ? 'text-green-700' :
                                                grade >= 6 ? 'text-yellow-700' :
                                                grade > 0 ? 'text-red-700' :
                                                'text-gray-500'
                                            }">
                                                ${grade > 0 ? `${grade} / 10` : 'Ù„Ù… ÙŠÙÙ‚ÙŠÙ‘Ù…'}
                                            </span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-4">
                                            <div class="${
                                                grade >= 8 ? 'bg-green-600' :
                                                grade >= 6 ? 'bg-yellow-600' :
                                                grade > 0 ? 'bg-red-600' :
                                                'bg-gray-400'
                                            } h-4 rounded-full flex items-center justify-center text-white text-xs font-bold" 
                                                 style="width: ${percentage}%">
                                                ${grade > 0 ? `${percentage.toFixed(0)}%` : ''}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- Final Grade Summary -->
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-300 rounded-lg p-6">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color)">
                            ğŸ¯ Ù…Ù„Ø®Øµ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                        </h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</div>
                                <div class="text-2xl font-bold text-purple-800">${totalGrades.toFixed(1)}</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙŠÙ‘Ù…Ø©</div>
                                <div class="text-2xl font-bold text-blue-800">${countedHomeworks}</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-1">Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
                                <div class="text-3xl font-bold ${
                                    finalGrade >= 8 ? 'text-green-700' :
                                    finalGrade >= 6 ? 'text-yellow-700' :
                                    finalGrade > 0 ? 'text-red-700' :
                                    'text-gray-700'
                                }">
                                    ${finalGrade} / 10
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Important Notes -->
                    <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-6">
                        <h3 class="text-lg font-bold text-blue-800 mb-3">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©</h3>
                        <ul class="space-y-2 text-sm text-blue-700">
                            <li>â€¢ ÙƒÙ„ ÙˆØ§Ø¬Ø¨ ÙŠÙÙ‚ÙŠÙ‘Ù… Ù…Ù† 10 Ø¯Ø±Ø¬Ø§Øª</li>
                            <li>â€¢ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© = Ù…ØªÙˆØ³Ø· Ø¯Ø±Ø¬Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙŠÙ‘Ù…Ø©</li>
                            <li>â€¢ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ù…ØªØ§Ø²Ø©: 8 ÙØ£ÙƒØ«Ø± | Ø§Ù„Ø¬ÙŠØ¯Ø©: 6-7.9 | ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†: Ø£Ù‚Ù„ Ù…Ù† 6</li>
                            <li>â€¢ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø¨Ø¹Ø¯ ØªØµØ­ÙŠØ­ ÙƒÙ„ ÙˆØ§Ø¬Ø¨ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…</li>
                            <li>â€¢ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ù†Ø¬Ø§Ø­: 6 Ù…Ù† 10</li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        // Show Student Attendance
        function showStudentAttendance() {
            const content = document.getElementById('studentContent');
            const student = currentUser.data;
            const attendance = loadFromStorage(STORAGE_KEYS.ATTENDANCE, []);
            const weeks = generateTermWeeks();
            
            // Get student's attendance records
            const studentAttendance = attendance.filter(a => a.studentCode === student.code);
            
            // Calculate statistics
            let presentCount = 0;
            let absentCount = 0;
            
            const attendanceByWeek = {};
            studentAttendance.forEach(record => {
                attendanceByWeek[record.week] = record.present;
                if (record.present) {
                    presentCount++;
                } else {
                    absentCount++;
                }
            });
            
            const totalWeeks = 15;
            const attendanceRate = totalWeeks > 0 ? Math.round((presentCount / totalWeeks) * 100) : 0;
            
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Statistics Cards -->
                    <div class="grid md:grid-cols-4 gap-4">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">ğŸ“Š</div>
                            <h3 class="text-2xl font-bold text-blue-800">${totalWeeks}</h3>
                            <p class="text-blue-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">âœ…</div>
                            <h3 class="text-2xl font-bold text-green-800">${presentCount}</h3>
                            <p class="text-green-600 text-sm">Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">âŒ</div>
                            <h3 class="text-2xl font-bold text-red-800">${absentCount}</h3>
                            <p class="text-red-600 text-sm">Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 text-center">
                            <div class="text-3xl mb-2">ğŸ“ˆ</div>
                            <h3 class="text-2xl font-bold text-purple-800">${attendanceRate}%</h3>
                            <p class="text-purple-600 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</p>
                        </div>
                    </div>
                    
                    <!-- Attendance Status Message -->
                    <div class="rounded-lg p-6 text-center ${
                        attendanceRate >= 80 ? 'bg-green-50 border-2 border-green-300' :
                        attendanceRate >= 60 ? 'bg-yellow-50 border-2 border-yellow-300' :
                        'bg-red-50 border-2 border-red-300'
                    }">
                        <div class="text-4xl mb-3">
                            ${attendanceRate >= 80 ? 'ğŸŒŸ' : attendanceRate >= 60 ? 'âš ï¸' : 'ğŸš¨'}
                        </div>
                        <h3 class="text-xl font-bold mb-2 ${
                            attendanceRate >= 80 ? 'text-green-800' :
                            attendanceRate >= 60 ? 'text-yellow-800' :
                            'text-red-800'
                        }">
                            ${
                                attendanceRate >= 80 ? 'Ù…Ù…ØªØ§Ø²! Ø­Ø¶ÙˆØ±Ùƒ Ù…Ù†ØªØ¸Ù…' :
                                attendanceRate >= 60 ? 'Ø¬ÙŠØ¯! Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø³ÙŠÙ† Ø­Ø¶ÙˆØ±Ùƒ' :
                                'ØªØ­Ø°ÙŠØ±! Ù†Ø³Ø¨Ø© Ø­Ø¶ÙˆØ±Ùƒ Ù…Ù†Ø®ÙØ¶Ø©'
                            }
                        </h3>
                        <p class="text-sm ${
                            attendanceRate >= 80 ? 'text-green-700' :
                            attendanceRate >= 60 ? 'text-yellow-700' :
                            'text-red-700'
                        }">
                            ${
                                attendanceRate >= 80 ? 'Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø­Ø¶ÙˆØ±Ùƒ Ø§Ù„Ù…Ù†ØªØ¸Ù…' :
                                attendanceRate >= 60 ? 'Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø§Ù†ØªØ¸Ø§Ù… Ø£ÙƒØ«Ø±' :
                                'ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØ­Ø³ÙŠÙ† Ù†Ø³Ø¨Ø© Ø­Ø¶ÙˆØ±Ùƒ Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ²'
                            }
                        </p>
                    </div>
                    
                    <!-- Weekly Attendance Details -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color)">
                            ğŸ“… Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ - Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„
                        </h3>
                        
                        <div class="grid md:grid-cols-3 gap-4">
                            ${weeks.map((week, index) => {
                                const weekNumber = index + 1;
                                const isPresent = attendanceByWeek[weekNumber];
                                const hasRecord = attendanceByWeek.hasOwnProperty(weekNumber);
                                
                                return `
                                    <div class="week-card ${
                                        hasRecord ? (isPresent ? 'border-green-400' : 'border-red-400') : 'border-gray-300'
                                    }">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-bold text-gray-700">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${weekNumber}</span>
                                            <span class="text-2xl">
                                                ${hasRecord ? (isPresent ? 'âœ…' : 'âŒ') : 'â³'}
                                            </span>
                                        </div>
                                        <div class="text-xs text-gray-600 mb-2">
                                            ${week.start} - ${week.end}
                                        </div>
                                        <div class="text-center">
                                            <span class="status-badge ${
                                                hasRecord ? (isPresent ? 'status-present' : 'status-absent') : 'bg-gray-100 text-gray-600'
                                            }">
                                                ${hasRecord ? (isPresent ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§Ø¦Ø¨') : 'Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¨Ø¹Ø¯'}
                                            </span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- Attendance Chart -->
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--primary-color)">
                            ğŸ“Š Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø­Ø¶ÙˆØ±
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-semibold text-green-700">Ø§Ù„Ø­Ø¶ÙˆØ±</span>
                                    <span class="text-sm font-semibold text-green-700">${presentCount} / ${totalWeeks}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-6">
                                    <div class="bg-green-600 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold" 
                                         style="width: ${(presentCount / totalWeeks) * 100}%">
                                        ${Math.round((presentCount / totalWeeks) * 100)}%
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-semibold text-red-700">Ø§Ù„ØºÙŠØ§Ø¨</span>
                                    <span class="text-sm font-semibold text-red-700">${absentCount} / ${totalWeeks}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-6">
                                    <div class="bg-red-600 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold" 
                                         style="width: ${(absentCount / totalWeeks) * 100}%">
                                        ${Math.round((absentCount / totalWeeks) * 100)}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Important Notes -->
                    <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-6">
                        <h3 class="text-lg font-bold text-blue-800 mb-3">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©</h3>
                        <ul class="space-y-2 text-sm text-blue-700">
                            <li>â€¢ ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù…Ù† ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø© Ø¥Ù„Ù‰ ÙŠÙˆÙ… Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ Ù…Ù† ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹</li>
                            <li>â€¢ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø­Ø¶ÙˆØ± Ù‡Ùˆ 80% Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ²</li>
                            <li>â€¢ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø§Ø¶Ø·Ø±Ø§Ø±ÙŠØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¨Ù„Ø§Øº Ø®Ø§Ø¯Ù… Ø§Ù„ÙØµÙ„</li>
                            <li>â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø¶ÙˆØ±Ùƒ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ù…Ù† Ø®Ù„Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // Update Dashboard Stats
        function updateDashboardStats() {
            const students = loadFromStorage(STORAGE_KEYS.STUDENTS, []);
            const teachers = loadFromStorage(STORAGE_KEYS.TEACHERS, []);
            
            const totalStudentsEl = document.getElementById('totalStudentsCount');
            const totalTeachersEl = document.getElementById('totalTeachersCount');
            
            if (totalStudentsEl) totalStudentsEl.textContent = students.length;
            if (totalTeachersEl) totalTeachersEl.textContent = teachers.length;
        }

        // Modal Helper
        function createModal(title, content) {
            const modal = document.createElement('div');
            modal.id = 'customModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">${title}</h2>
                            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        ${content}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            return modal;
        }

        function closeModal() {
            const modal = document.getElementById('customModal');
            if (modal) modal.remove();
        }

        // Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-600' : 'bg-red-600'
            } text-white`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeSystem);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99d768457723e1f1',t:'MTc2Mjk2NDk1Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
